<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hands Please Breakfast Quiz</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --brand: #d35400;
            --brand-dark: #a04000;
            --egg: #f39c12;
            --bg: #fdfbf7;
            --text: #2c3e50;
            --white: #ffffff;
            --success: #27ae60;
            --danger: #c0392b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            z-index: 10;
        }

        .screen.active { display: flex; z-index: 20; }

        .card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 30px 20px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.05);
        }

        h1 { font-size: 26px; color: var(--brand); margin-bottom: 10px; line-height: 1.3; }
        h2 { font-size: 22px; margin-bottom: 15px; color: var(--text); }
        p { color: #666; margin-bottom: 20px; line-height: 1.5; font-size: 15px; }

        .btn {
            background: var(--brand);
            color: white;
            border: none;
            padding: 15px 20px;
            width: 100%;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            margin-top: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn:hover { background: var(--brand-dark); }

        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 17px;
            text-align: center;
            margin-bottom: 15px;
            outline: none;
            font-family: inherit;
        }
        input:focus { border-color: var(--brand); }

        .hud {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 450px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #7f8c8d;
            font-size: 14px;
        }

        .question-text {
            font-size: 19px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text);
            text-align: left;
            line-height: 1.4;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            margin-bottom: 15px;
        }

        .option-btn {
            background: var(--white);
            border: 2px solid #eee;
            padding: 15px;
            border-radius: 12px;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            font-weight: 500;
        }

        .option-btn.selected { border-color: var(--brand); background: #fff5eb; }
        .option-btn.correct { border-color: var(--success); background: #e8f8f5; color: var(--success); font-weight: 700; }
        .option-btn.wrong { border-color: var(--danger); background: #fdedec; color: var(--danger); }

        .leaderboard-container {
            width: 100%;
            max-width: 450px;
            max-height: 55vh;
            overflow-y: auto;
            margin-bottom: 15px;
            border-radius: 12px;
            background: #fafafa;
            padding: 10px;
        }

        .leaderboard-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: 15px;
        }

        .leaderboard-row:last-child { border-bottom: none; }

        .leaderboard-row.champion {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe6b3 100%);
            border-radius: 12px;
            border: 2px solid #ffd700;
            margin-bottom: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(241, 196, 15, 0.3);
        }
        
        .rank-1-badge { font-size: 24px; margin-right: 8px; }

        .champion-title {
            display: block;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--brand);
            font-weight: 800;
            margin-top: 3px;
        }

        .chicken-stage {
            height: 100px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chicken-emoji { font-size: 70px; transition: all 0.3s; }
        .chicken-emoji.bounce { animation: bounce 0.5s infinite alternate; }
        .chicken-emoji.shake { animation: shake 0.3s; }
        @keyframes bounce { to { transform: translateY(-10px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        .admin-toggle {
            position: fixed;
            bottom: 10px;
            right: 10px;
            opacity: 0.3;
            font-size: 10px;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 100;
            color: #999;
        }
        
        .delete-btn {
            background: none;
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .admin-list {
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
            width: 100%;
            margin-top: 15px;
        }
        
        .admin-item {
            border-bottom: 1px solid #eee;
            padding: 12px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .link-btn {
            background: none;
            border: none;
            color: var(--brand);
            text-decoration: underline;
            font-weight: 600;
            cursor: pointer;
            font-size: 15px;
            margin-top: 15px;
        }

        @media (max-width: 400px) {
            .card { padding: 25px 15px; }
            h1 { font-size: 24px; }
            .question-text { font-size: 17px; }
            .option-btn { font-size: 14px; padding: 12px; }
        }
    </style>
</head>
<body>

    <!-- SCREEN 1: WELCOME & NAME ENTRY -->
    <div id="startScreen" class="screen active">
        <div class="card">
            <div class="chicken-stage"><div class="chicken-emoji">üêî</div></div>
            <h1>Hands Please<br>Breakfast Quiz</h1>
            <p>Prove your menu knowledge and become the Superduper Breakfast Champion!</p>
            
            <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
            
            <button class="btn" onclick="startGame()">Start Quiz</button>
            <button class="link-btn" onclick="showLeaderboard()">View Leaderboard</button>
        </div>
    </div>

    <!-- SCREEN 2: QUIZ -->
    <div id="quizScreen" class="screen">
        <div class="hud">
            <span id="playerDisplay">Player</span>
            <span id="scoreDisplay">0 / 0</span>
        </div>
        <div class="card">
            <div class="chicken-stage"><div id="quizChicken" class="chicken-emoji">ü•ö</div></div>
            <div id="questionContainer">
                <div class="question-text" id="questionText">Loading...</div>
                <div class="options-grid" id="optionsGrid"></div>
            </div>
            <button id="nextBtn" class="btn" style="display:none;" onclick="nextQuestion()">Next Question</button>
        </div>
    </div>

    <!-- SCREEN 3: RESULTS & LEADERBOARD -->
    <div id="resultScreen" class="screen">
        <div class="card">
            <div class="chicken-stage"><div id="resultChicken" class="chicken-emoji">üê£</div></div>
            <h2 id="resultTitle">Quiz Complete!</h2>
            <p id="resultMessage"></p>
            <div class="leaderboard-container" id="leaderboardContent"></div>
            <button class="btn" onclick="location.reload()">Play Again</button>
        </div>
    </div>
    
    <!-- ADMIN MODAL -->
    <div id="adminModal" class="screen" style="background:rgba(0,0,0,0.9);">
        <div class="card">
            <h2>Admin Access</h2>
            <input type="password" id="adminPass" placeholder="Password">
            <button class="btn" onclick="verifyAdmin()">Login</button>
            <button class="btn" style="background:#7f8c8d; margin-top:10px;" onclick="closeAdmin()">Cancel</button>
        </div>
    </div>
    
    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="screen">
         <div class="card" style="max-width:600px;">
            <h2>Admin Control Panel</h2>
            <p style="font-size:14px; color:#999;">Manage Leaderboard Scores</p>
            <div id="adminLeaderboardList" class="admin-list"></div>
            <button class="btn" style="margin-top:20px;" onclick="location.reload()">Exit Admin</button>
         </div>
    </div>

    <button class="admin-toggle" onclick="openAdmin()">Admin</button>

    <script>
        // CONFIGURATION
        const SUPABASE_URL = 'https://beyeqxromrqoiruejddp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJleWVxeHJvbXJxb2lydWVqZGRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5MjcwMDEsImV4cCI6MjA4NTUwMzAwMX0.LIt8CG0DYeQDXE1RhvGPNyjVdK8SarSGuXJJJd2Ku7o';
        const ADMIN_PASSWORD = 'Iworkfortips';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // QUIZ DATA
        const questions = [
            {
                q: "What meats come with the Farmhouse Breakfast?",
                options: ["Bacon or Sausage", "Ham or Bacon", "Sausage or Turkey", "Bacon only"],
                a: 0
            },
            {
                q: "Is the Farmhouse Breakfast suitable for Celiacs?",
                options: ["Yes, completely", "No, fryer cross-contamination", "Yes, if no toast", "Only if vegan"],
                a: 1
            },
            {
                q: "What is in the BLVD Power Bowl?",
                options: ["Oatmeal & berries", "Yoghurt, smoothie, granola, fruit", "Just fruit salad", "Cornflakes & milk"],
                a: 1
            },
            {
                q: "Is the Power Bowl Vegan?",
                options: ["Yes", "No (contains yoghurt/honey)", "Only without granola", "Yes if no milk"],
                a: 1
            },
            {
                q: "What nut is in the Steel-cut Oatmeal crumble?",
                options: ["Walnuts", "Peanuts", "Almonds & Pumpkin Seeds", "Macadamia"],
                a: 2
            },
            {
                q: "How are the eggs cooked in 'Over Hard'?",
                options: ["Runny yolk", "Un-flipped", "Flipped, fully cooked yolk", "Poached"],
                a: 2
            },
            {
                q: "The Deluxe Continental includes which pastries?",
                options: ["Muffin & Toast", "Croissant, Danish, Cornbread", "Bagel & Cream Cheese", "Scone & Jam"],
                a: 1
            },
            {
                q: "Where are the sausages sourced from?",
                options: ["Costco", "Two Rivers (North Van)", "Sysco", "Homemade"],
                a: 1
            }
        ];

        // STATE
        let currentPlayer = "";
        let currentQuestionIndex = 0;
        let score = 0;
        let isAdmin = false;

        // NAVIGATION
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        async function startGame() {
            const nameInput = document.getElementById('playerName');
            if (!nameInput.value.trim()) {
                alert("Please enter your name!");
                return;
            }
            currentPlayer = nameInput.value.trim();
            document.getElementById('playerDisplay').textContent = currentPlayer;
            currentQuestionIndex = 0;
            score = 0;
            showScreen('quizScreen');
            loadQuestion();
        }

        // GAMEPLAY
        function loadQuestion() {
            const q = questions[currentQuestionIndex];
            document.getElementById('questionText').textContent = q.q;
            document.getElementById('scoreDisplay').textContent = `${score} / ${questions.length}`;
            
            const grid = document.getElementById('optionsGrid');
            grid.innerHTML = '';
            
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('quizChicken').className = 'chicken-emoji';
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => selectAnswer(idx, btn);
                grid.appendChild(btn);
            });
        }

        function selectAnswer(selectedIndex, btnElement) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true);
            
            const correctIndex = questions[currentQuestionIndex].a;
            
            if (selectedIndex === correctIndex) {
                btnElement.classList.add('correct');
                score++;
                document.getElementById('quizChicken').classList.add('bounce');
                document.getElementById('quizChicken').textContent = "üê£";
            } else {
                btnElement.classList.add('wrong');
                buttons[correctIndex].classList.add('correct');
                document.getElementById('quizChicken').classList.add('shake');
                document.getElementById('quizChicken').textContent = "üçó";
            }
            
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                finishQuiz();
            }
        }

        async function finishQuiz() {
            showScreen('resultScreen');
            document.getElementById('resultMessage').textContent = `You scored ${score} out of ${questions.length}`;
            
            const chicken = document.getElementById('resultChicken');
            if(score === questions.length) {
                chicken.textContent = "ü¶Ö";
                document.getElementById('resultTitle').textContent = "FLAWLESS VICTORY!";
            } else if (score > questions.length / 2) {
                chicken.textContent = "üêî";
            } else {
                chicken.textContent = "üç≥";
            }

            await saveScoreToSupabase(currentPlayer, score, questions.length);
            loadLeaderboard();
        }

        // SUPABASE INTEGRATION
        async function saveScoreToSupabase(name, score, total) {
            try {
                const { error } = await supabase
                    .from('leaderboard')
                    .insert([{ player_name: name, score: score, total_questions: total }]);
                
                if (error) throw error;
            } catch (err) {
                console.error("Error saving score:", err);
                alert("Could not save score. Check console for details.");
            }
        }

        async function loadLeaderboard() {
            const container = document.getElementById('leaderboardContent');
            container.innerHTML = '<div style="text-align:center; padding:20px; color:#999;">Loading scores...</div>';
            
            try {
                const { data, error } = await supabase
                    .from('leaderboard')
                    .select('*')
                    .order('score', { ascending: false })
                    .order('created_at', { ascending: true })
                    .limit(50);

                if (error) throw error;

                renderLeaderboard(data, container);

            } catch (err) {
                console.error("Error loading leaderboard:", err);
                container.innerHTML = '<div style="color:red; text-align:center; padding:20px;">Failed to load. Check your internet connection and refresh the page.</div>';
            }
        }

        function renderLeaderboard(data, container) {
            container.innerHTML = '';
            
            if (data.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:30px; color:#999;">No scores yet.<br>Be the first champion! üèÜ</div>';
                return;
            }

            // Find the highest score
            const topScore = data[0].score;

            data.forEach((entry, index) => {
                const row = document.createElement('div');
                row.className = 'leaderboard-row';
                
                // Check if this entry has the top score (could be multiple champions!)
                const isChampion = entry.score === topScore;
                
                // Add champion class if this is a top scorer
                if (isChampion) {
                    row.classList.add('champion');
                }
                
                let rankHTML = `<span style="font-weight:bold; width:30px; color:#aaa;">${index + 1}</span>`;
                let contentHTML = `<span style="font-weight:600;">${entry.player_name}</span>`;
                
                if (isChampion) {
                    rankHTML = `<span class="rank-1-badge">üëë</span>`;
                    contentHTML = `
                        <div>
                            <span style="font-weight:800; font-size:17px;">${entry.player_name}</span>
                            <span class="champion-title">üèÜ Superduper Breakfast Champion!</span>
                        </div>
                    `;
                }

                row.innerHTML = `
                    <div style="display:flex; align-items:center; gap:8px;">
                        ${rankHTML}
                        ${contentHTML}
                    </div>
                    <strong style="color:var(--brand); font-size:16px;">${entry.score}/${entry.total_questions}</strong>
                `;
                
                container.appendChild(row);
            });
        }
        
        function showLeaderboard() {
            showScreen('resultScreen');
            document.getElementById('resultTitle').textContent = "üèÜ Leaderboard";
            document.getElementById('resultMessage').textContent = "Top players across all devices";
            document.getElementById('resultChicken').style.display = 'none';
            loadLeaderboard();
        }

        // ADMIN FUNCTIONS
        function openAdmin() { showScreen('adminModal'); }
        function closeAdmin() { showScreen('startScreen'); }

        function verifyAdmin() {
            const pass = document.getElementById('adminPass').value;
            if (pass === ADMIN_PASSWORD) {
                isAdmin = true;
                loadAdminPanel();
            } else {
                alert("Wrong password!");
            }
        }

        async function loadAdminPanel() {
            showScreen('adminPanel');
            const list = document.getElementById('adminLeaderboardList');
            list.innerHTML = '<div style="text-align:center; color:#999;">Loading...</div>';

            const { data, error } = await supabase
                .from('leaderboard')
                .select('*')
                .order('created_at', { ascending: false });

            if (data) {
                list.innerHTML = '';
                if (data.length === 0) {
                    list.innerHTML = '<div style="text-align:center; padding:20px; color:#999;">No scores to manage yet.</div>';
                    return;
                }
                data.forEach(entry => {
                    const item = document.createElement('div');
                    item.className = 'admin-item';
                    item.innerHTML = `
                        <span><b>${entry.player_name}</b> - ${entry.score}/${entry.total_questions}</span>
                        <button class="delete-btn" onclick="deleteScore(${entry.id})">Delete</button>
                    `;
                    list.appendChild(item);
                });
            } else {
                list.innerHTML = '<div style="color:red; text-align:center;">Error loading data</div>';
            }
        }

        async function deleteScore(id) {
            if(!confirm("Delete this score?")) return;
            
            const { error } = await supabase
                .from('leaderboard')
                .delete()
                .eq('id', id);
                
            if (!error) {
                loadAdminPanel();
            } else {
                alert("Error deleting score");
            }
        }
    </script>
</body>
</html>
