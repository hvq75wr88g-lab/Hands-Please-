<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breakfast Quiz - Hands Please</title>
  <style>
    :root{
      --eggshell: #f3efe6;
      --ink: #1f2328;
      --accent: #d35400;
      --danger: #c0392b;
      --ok: #27ae60;
    }

    *{ box-sizing: border-box; margin: 0; padding: 0; }
    
    html, body{ height: 100%; overflow: hidden; }

    body{
      background: var(--eggshell);
      background-image: radial-gradient(circle, #ccc 1px, transparent 1px);
      background-size: 20px 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      color: var(--ink);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .mainContainer{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
      max-width: 1400px;
      width: 100%;
      height: 100%;
    }

    .eggsHUD{
      display: flex;
      flex-direction: column;
      gap: 30px;
      align-items: center;
    }

    .egg{
      width: 80px;
      height: 100px;
      background: linear-gradient(145deg, #fff, #f0f0f0);
      border: 3px solid #ddd;
      border-radius: 50% 50% 45% 45%;
      box-shadow: 0 6px 0 #ccc, inset 0 2px 0 rgba(255,255,255,0.8);
      position: relative;
      transition: all 0.3s ease;
    }

    .egg::after{
      content: '';
      position: absolute;
      top: 20px;
      left: 20px;
      width: 16px;
      height: 20px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      transform: rotate(-30deg);
    }

    .egg.cracked{
      background: #e8e8e8;
      border-color: #999;
      transform: rotate(8deg);
      animation: crackShake 0.3s ease-out;
    }

    @keyframes crackShake{
      0%, 100%{ transform: rotate(8deg); }
      25%{ transform: rotate(12deg); }
      50%{ transform: rotate(4deg); }
      75%{ transform: rotate(10deg); }
    }

    .egg.cracked::before{
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background-image:
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 100"><path d="M40 8 L41 14 L38 19 L42 26 L39 33 L43 41 L38 49 L41 57 L44 65 L39 73 L42 82 L40 92" stroke="%23999" stroke-width="1.8" fill="none" stroke-linecap="round"/><path d="M40 12 L34 17 M40 20 L46 26 M39 30 L32 36 M43 38 L49 44 M38 52 L31 58 M41 60 L48 66 M44 70 L50 75 M39 78 L33 83" stroke="%23aaa" stroke-width="1.2" fill="none" stroke-linecap="round"/><path d="M25 25 Q30 28 35 26 M55 25 Q50 28 45 26 M20 40 Q25 43 30 41 M60 40 Q55 43 50 41 M22 55 Q27 58 32 56 M58 55 Q53 58 48 56 M24 70 Q29 73 34 71 M56 70 Q51 73 46 71 M28 85 Q33 88 38 86 M52 85 Q47 88 42 86" stroke="%23bbb" stroke-width="0.9" fill="none"/><path d="M15 30 L25 35 L20 40 M65 30 L55 35 L60 40 M18 50 L28 55 L23 60 M62 50 L52 55 L57 60 M16 68 L26 73 L21 78 M64 68 L54 73 L59 78" stroke="%23ccc" stroke-width="0.7" fill="none" stroke-linecap="round"/><path d="M30 15 Q35 18 40 16 Q45 18 50 15 M28 35 Q33 38 38 36 Q43 38 48 35 M26 55 Q31 58 36 56 Q41 58 46 55 M29 75 Q34 78 39 76 Q44 78 49 75" stroke="%23aaa" stroke-width="0.8" fill="none"/><path d="M35 22 L38 28 L34 32 M46 22 L43 28 L47 32 M33 44 L36 50 L32 54 M48 44 L45 50 L49 54 M31 64 L34 70 L30 74 M50 64 L47 70 L51 74" stroke="%23bbb" stroke-width="0.6" fill="none" stroke-linecap="round"/></svg>');
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 1;
    }

    .quizCard{
      width: 100%;
      max-width: 600px;
      background: white;
      border: 2px solid rgba(0,0,0,0.1);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      max-height: 90vh;
      overflow-y: auto;
    }

    .quizHeader{
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: 14px;
      font-weight: bold;
      color: #7f8c8d;
    }

    .quizTitle{
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: var(--accent);
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .questionText{
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    .choices{
      display: grid;
      gap: 12px;
      margin-bottom: 15px;
    }

    .choice{
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border: 2px solid #ecf0f1;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 16px;
      background: white;
    }

    .choice:hover{
      border-color: var(--accent);
      background: #fff9f0;
      transform: translateX(5px);
    }

    .choice input{
      width: 20px;
      height: 20px;
      accent-color: var(--accent);
    }

    .submitBtn{
      width: 100%;
      padding: 16px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    .submitBtn:hover{ background: #e67e22; }
    .submitBtn:disabled{ opacity: 0.5; cursor: not-allowed; }

    .feedback{
      text-align: center;
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
      min-height: 24px;
    }

    .chickenStage{
      display: flex;
      align-items: center;
      justify-content: center;
      width: 300px;
      height: 300px;
      position: relative;
    }

    .chickenImage{
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: none;
    }

    .chickenImage.active{
      display: block;
    }

    body.happy .chickenImage.happy{ 
      display: block;
      animation: bounceChicken 0.6s ease-in-out infinite alternate;
    }

    body.angry .chickenImage.angry{ 
      display: block;
      animation: shakeChicken 0.12s linear infinite;
    }

    body.wink .chickenImage.wink{ 
      display: block;
      animation: breatheChicken 3s ease-in-out infinite;
    }

    body.peck .chickenImage.angry{ 
      display: block;
      animation: peckChicken 0.5s ease-in-out infinite;
    }

    @keyframes bounceChicken{
      from{ transform: translateY(0); }
      to{ transform: translateY(-30px); }
    }

    @keyframes shakeChicken{
      0%{ transform: translate(2px, 1px) rotate(0deg); }
      25%{ transform: translate(-2px, -2px) rotate(-1deg); }
      50%{ transform: translate(2px, 2px) rotate(1deg); }
      75%{ transform: translate(-2px, 1px) rotate(-1deg); }
      100%{ transform: translate(2px, -1px) rotate(0deg); }
    }

    @keyframes breatheChicken{
      0%, 100%{ transform: scale(1); }
      50%{ transform: scale(1.03); }
    }

    @keyframes peckChicken{
      0%{ transform: scale(1) translateY(0); }
      50%{ transform: scale(1.5) translateY(30px); }
      100%{ transform: scale(1) translateY(0); }
    }

    .gameOverPopup{
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 450px;
      background: white;
      border: 5px solid var(--danger);
      border-radius: 24px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 40px 80px rgba(0,0,0,0.4);
      z-index: 100;
      display: none;
    }

    .gameOverPopup h2{
      font-size: 32px;
      color: var(--danger);
      margin-bottom: 15px;
    }

    .gameOverPopup p{
      font-size: 18px;
      margin-bottom: 10px;
      color: #555;
    }

    .gameOverPopup button{
      margin-top: 20px;
      padding: 16px 40px;
      background: var(--ink);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }

    .adminLink{
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 11px;
      color: #95a5a6;
      text-decoration: none;
      background: rgba(255,255,255,0.8);
      padding: 5px 10px;
      border-radius: 6px;
      z-index: 200;
    }

    .adminLink:hover{ color: var(--accent); }

    .adminModal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
      overflow-y: auto;
      padding: 20px;
    }

    .adminPanel{
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 700px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .adminHeader{
      padding: 20px;
      border-bottom: 2px solid #ecf0f1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .adminHeader h2{
      color: var(--accent);
      font-size: 24px;
    }

    .adminBody{
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .adminControls{
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btnAdmin{
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    .btnPrimary{ background: var(--accent); color: white; }
    .btnPrimary:hover{ background: #e67e22; }
    .btnSecondary{ background: #ecf0f1; color: var(--ink); }
    .btnSecondary:hover{ background: #d5dbdb; }
    .btnDanger{ background: var(--danger); color: white; }
    .btnDanger:hover{ background: #a93226; }

    .questionsList{
      display: grid;
      gap: 15px;
      margin-bottom: 20px;
    }

    .qCard{
      border: 2px solid #ecf0f1;
      border-radius: 12px;
      padding: 15px;
      background: #fafafa;
    }

    .qCard .qText{
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
      color: var(--ink);
    }

    .qCard .qChoices{
      font-size: 14px;
      color: #555;
      margin-bottom: 10px;
      padding-left: 10px;
    }

    .qCard .qChoices div{
      margin: 5px 0;
    }

    .qCard .qChoices .correct{
      color: var(--ok);
      font-weight: bold;
    }

    .qCard .qActions{
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .editorForm{
      display: none;
      background: white;
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .editorForm.active{ display: block; }

    .formField{
      margin-bottom: 15px;
    }

    .formField label{
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
      color: var(--ink);
    }

    .formField input[type="text"],
    .formField textarea{
      width: 100%;
      padding: 10px;
      border: 2px solid #ecf0f1;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }

    .formField input:focus,
    .formField textarea:focus{
      outline: none;
      border-color: var(--accent);
    }

    .formField textarea{ min-height: 80px; resize: vertical; }

    .choiceEditor{
      display: grid;
      gap: 10px;
    }

    .choiceRow{
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .choiceRow input[type="text"]{
      flex: 1;
      padding: 10px;
      border: 2px solid #ecf0f1;
      border-radius: 8px;
      font-size: 14px;
    }

    .choiceRow input[type="radio"]{
      width: 20px;
      height: 20px;
      accent-color: var(--ok);
    }

    .choiceRow button{
      padding: 8px 12px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    .formActions{
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    @media (max-width: 1200px) {
      .mainContainer{ gap: 20px; }
      .chickenStage{ width: 250px; height: 250px; }
      .eggsHUD{ gap: 20px; }
      .egg{ width: 70px; height: 87px; }
    }

    @media (max-width: 900px) {
      .mainContainer{ flex-direction: column; gap: 30px; }
      .eggsHUD{ flex-direction: row; gap: 30px; }
      .chickenStage{ width: 200px; height: 200px; }
    }

  </style>
</head>

<body class="wink">

  <div class="mainContainer">
    
    <div class="eggsHUD">
      <div class="egg" id="egg1"></div>
      <div class="egg" id="egg2"></div>
      <div class="egg" id="egg3"></div>
    </div>

    <div class="quizCard">
      <div class="quizHeader">
        <span id="qNum">Q 1/9</span>
        <span id="scoreDisplay">Score: 0</span>
      </div>
      
      <div class="quizTitle">Hands Please!</div>
      
      <div class="questionText" id="questionText">Loading...</div>
      
      <div class="choices" id="choicesContainer"></div>
      
      <button class="submitBtn" id="submitBtn">Submit Answer</button>
      
      <div class="feedback" id="feedbackText"></div>
    </div>

    <div class="chickenStage">
      <img class="chickenImage happy" id="happyImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/3e87e01e-4024-482b-a8ff-2413dc23cf56.png" alt="Happy Chicken">
      <img class="chickenImage angry" id="angryImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/2036a4c0-36eb-4538-bfd4-94ccb3f03b24.png" alt="Angry Chicken">
      <img class="chickenImage wink" id="winkImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/5e8433c9-0f98-4b40-8646-dcec028601b8.png" alt="Wink Chicken">
    </div>
  </div>

  <div class="gameOverPopup" id="gameOverPopup">
    <h2>Strike 3!</h2>
    <p>Oh oh! The chicken is NOT happy.</p>
    <p>Study hard and try again!</p>
    <button onclick="location.reload()">Restart Quiz</button>
  </div>

  <a href="#" class="adminLink" onclick="event.preventDefault(); openAdmin();">Admin</a>

  <div class="adminModal" id="adminModal">
    <div class="adminPanel">
      
      <div class="adminHeader">
        <h2>Question Bank Editor</h2>
        <button class="btnSecondary" onclick="closeAdmin()">Close</button>
      </div>

      <div class="adminBody">
        
        <div class="adminControls">
          <button class="btnPrimary" onclick="showAddForm()">‚ûï Add New Question</button>
          <button class="btnSecondary" onclick="resetToDefaults()">Reset to Defaults</button>
          <button class="btnSecondary" onclick="exportQuestions()">Export JSON</button>
          <button class="btnSecondary" onclick="importQuestions()">Import JSON</button>
        </div>

        <div class="editorForm" id="editorForm">
          <h3 style="margin-bottom:15px; color:var(--accent);">Edit Question</h3>
          
          <div class="formField">
            <label>Question Text:</label>
            <textarea id="editQuestionText" placeholder="Enter your question..."></textarea>
          </div>

          <div class="formField">
            <label>Answer Choices (check the correct one):</label>
            <div class="choiceEditor" id="choiceEditor"></div>
            <button class="btnSecondary" onclick="addChoiceRow()" style="margin-top:10px; padding:8px 12px; font-size:13px;">+ Add Choice</button>
          </div>

          <div class="formActions">
            <button class="btnPrimary" onclick="saveQuestion()">Save Question</button>
            <button class="btnSecondary" onclick="cancelEdit()">Cancel</button>
            <button class="btnDanger" onclick="deleteCurrentQuestion()" id="deleteBtn" style="display:none;">Delete Question</button>
          </div>
        </div>

        <div class="questionsList" id="questionsList"></div>

      </div>
    </div>
  </div>

  <script>
    const CHICKEN_IMAGES = {
      happy: [
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/3e87e01e-4024-482b-a8ff-2413dc23cf56.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/5cf3e5fe-edb5-4d16-98b8-d45e90eef68e.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/b498ce6d-decf-4441-8f26-57074747b8f5.png'
      ],
      angry: [
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/2036a4c0-36eb-4538-bfd4-94ccb3f03b24.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/43f53595-f8e6-49ff-8bdf-7cfa8fb1e359.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/bd76b9ab-3a56-49bf-a5e8-6aa9d74a16dd.png'
      ],
      wink: [
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/5e8433c9-0f98-4b40-8646-dcec028601b8.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/37753db4-6856-47fe-9f66-f652f7506e99.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/fa393d61-fd60-4e86-9889-d6e25461711f.png'
      ]
    };

    let currentFrame = 0;
    let animationInterval = null;

    function startChickenAnimation(mood) {
      stopChickenAnimation();
      
      const images = CHICKEN_IMAGES[mood];
      if (!images || images.length === 0) return;
      
      currentFrame = 0;
      updateChickenFrame(mood);
      
      animationInterval = setInterval(() => {
        currentFrame = (currentFrame + 1) % images.length;
        updateChickenFrame(mood);
      }, 200);
    }

    function updateChickenFrame(mood) {
      const img = document.querySelector(`.chickenImage.${mood}`);
      if (img) {
        img.src = CHICKEN_IMAGES[mood][currentFrame];
      }
    }

    function stopChickenAnimation() {
      if (animationInterval) {
        clearInterval(animationInterval);
        animationInterval = null;
      }
    }

    function setChickenMood(mood) {
      document.body.className = mood;
      startChickenAnimation(mood);
    }

    const DEFAULT_BANK = [
      { id: '1', q: "Describe Loop juices to a guest:", c: ["Imperfect produce, cold pressed, circular economy", "Fresh squeezed daily in-house", "Concentrate from cartons"], a: 0 },
      { id: '2', q: "Is the Farmhouse Breakfast gluten free?", c: ["Yes, it's naturally gluten free", "No - potatoes cooked in shared fryer (cross-contamination)", "Only if you remove the eggs"], a: 1 },
      { id: '3', q: "What can VEGAN guests eat?", c: ["Farmhouse Breakfast (no eggs)", "Vegan Mexican Scramble or Fruit Plate", "Eggs Benedict (hold hollandaise)"], a: 1 },
      { id: '4', q: "What's in the Power Bowl?", c: ["Oatmeal with brown sugar", "Greek yogurt, berries, granola, smoothie, fresh fruit", "Acai blend with granola"], a: 1 },
      { id: '5', q: "Components of Avocado Toast:", c: ["Sourdough, smashed avo, poached eggs, radish, pickled onion, feta", "Rye bread, fried egg, bacon", "Gluten free toast, plain avocado"], a: 0 },
      { id: '6', q: "Is the Oatmeal gluten free?", c: ["Yes, certified gluten free", "Cooked in water but NOT celiac-safe (trace risk)", "Only if ordered plain"], a: 1 },
      { id: '7', q: "Belgian Waffle comes with:", c: ["Just butter and syrup", "Fresh berries, maple whipped cream, salted caramel, icing sugar", "Chocolate sauce and banana"], a: 1 },
      { id: '8', q: "Dairy-free options:", c: ["Pancakes with butter", "Fruit Plate, Vegan Scramble, Oatmeal (water-cooked)", "Yogurt Bowl"], a: 1 },
      { id: '9', q: "Can Celiac guests have potatoes/fries?", c: ["Yes, totally safe", "No - cooked in shared fryer with gluten items", "Only baked potatoes"], a: 1 }
    ];

    let questions = [];
    let currentIdx = 0;
    let score = 0;
    let strikes = 0;
    let gameOver = false;
    let editingId = null;

    function init(){
      const stored = localStorage.getItem('handsPlease_quiz_v5');
      questions = stored ? JSON.parse(stored) : [...DEFAULT_BANK];
      
      questions.forEach((q, i) => {
        if(!q.id) q.id = 'q' + Date.now() + i;
      });
      
      questions.sort(() => Math.random() - 0.5);
      
      currentIdx = 0;
      score = 0;
      strikes = 0;
      gameOver = false;
      
      setChickenMood('wink');
      document.getElementById('gameOverPopup').style.display = 'none';
      document.querySelectorAll('.egg').forEach(e => e.className = 'egg');
      
      renderQuestion();
    }

    function renderQuestion(){
      if(currentIdx >= questions.length){
        finishQuiz(true);
        return;
      }

      const q = questions[currentIdx];

      document.getElementById('qNum').innerText = `Q ${currentIdx + 1}/${questions.length}`;
      document.getElementById('scoreDisplay').innerText = `Score: ${score}`;
      document.getElementById('questionText').innerText = q.q;
      document.getElementById('feedbackText').innerText = '';

      const container = document.getElementById('choicesContainer');
      container.innerHTML = '';

      q.c.forEach((choice, i) => {
        const label = document.createElement('label');
        label.className = 'choice';
        label.innerHTML = `<input type="radio" name="answer" value="${i}"> ${choice}`;
        container.appendChild(label);
      });

      document.getElementById('submitBtn').disabled = false;
    }

    document.getElementById('submitBtn').addEventListener('click', () => {
      if(gameOver) return;

      const selected = document.querySelector('input[name="answer"]:checked');
      if(!selected){
        document.getElementById('feedbackText').innerText = '‚ö†Ô∏è Please select an answer';
        return;
      }

      const answer = parseInt(selected.value);
      const q = questions[currentIdx];
      const correct = (answer === q.a);

      if(correct){
        score++;
        document.getElementById('feedbackText').innerText = '‚úÖ Correct!';
        document.getElementById('feedbackText').style.color = 'var(--ok)';
        setChickenMood('happy');
        
        setTimeout(() => {
          currentIdx++;
          renderQuestion();
          setChickenMood('wink');
        }, 1500);
      } else {
        strikes++;
        document.getElementById('feedbackText').innerText = `‚ùå Wrong! Correct: ${q.c[q.a]}`;
        document.getElementById('feedbackText').style.color = 'var(--danger)';
        
        if(strikes <= 3){
          const egg = document.getElementById('egg' + strikes);
          egg.classList.add('cracked');
        }

        setChickenMood('angry');

        if(strikes >= 3){
          gameOver = true;
          setTimeout(() => {
            document.getElementById('gameOverPopup').style.display = 'block';
            setChickenMood('peck');
          }, 1000);
        } else {
          setTimeout(() => {
            currentIdx++;
            renderQuestion();
            setChickenMood('wink');
          }, 2000);
        }
      }

      document.getElementById('submitBtn').disabled = true;
    });

    function finishQuiz(completed){
      if(strikes < 3 && completed){
        alert(`üéâ Quiz Complete!\n\nYour Score: ${score}/${questions.length}\n\nGreat job! üêî`);
        location.reload();
      }
    }

    function openAdmin(){
      document.getElementById('adminModal').style.display = 'flex';
      refreshQuestionsList();
    }

    function closeAdmin(){
      document.getElementById('adminModal').style.display = 'none';
      cancelEdit();
    }

    function refreshQuestionsList(){
      const list = document.getElementById('questionsList');
      list.innerHTML = '';
      
      questions.forEach((q, idx) => {
        const card = document.createElement('div');
        card.className = 'qCard';
        
        const choicesHTML = q.c.map((c, i) => 
          `<div class="${i === q.a ? 'correct' : ''}">${i === q.a ? '‚úì' : '‚óã'} ${c}</div>`
        ).join('');
        
        card.innerHTML = `
          <div class="qText">${idx + 1}. ${q.q}</div>
          <div class="qChoices">${choicesHTML}</div>
          <div class="qActions">
            <button class="btnSecondary" onclick="editQuestion('${q.id}')">Edit</button>
          </div>
        `;
        
        list.appendChild(card);
      });
    }

    function showAddForm(){
      editingId = null;
      document.getElementById('editQuestionText').value = '';
      document.getElementById('choiceEditor').innerHTML = '';
      
      for(let i = 0; i < 3; i++){
        addChoiceRow('', i === 0);
      }
      
      document.getElementById('deleteBtn').style.display = 'none';
      document.getElementById('editorForm').classList.add('active');
    }

    function editQuestion(id){
      const q = questions.find(x => x.id === id);
      if(!q) return;
      
      editingId = id;
      document.getElementById('editQuestionText').value = q.q;
      
      const editor = document.getElementById('choiceEditor');
      editor.innerHTML = '';
      
      q.c.forEach((choice, i) => {
        addChoiceRow(choice, i === q.a);
      });
      
      document.getElementById('deleteBtn').style.display = 'block';
      document.getElementById('editorForm').classList.add('active');
    }

    function addChoiceRow(text = '', isCorrect = false){
      const editor = document.getElementById('choiceEditor');
      const row = document.createElement('div');
      row.className = 'choiceRow';
      
      row.innerHTML = `
        <input type="text" value="${text}" placeholder="Choice text...">
        <input type="radio" name="correctChoice" ${isCorrect ? 'checked' : ''}>
        <button onclick="this.parentElement.remove()">‚úï</button>
      `;
      
      editor.appendChild(row);
    }

    function saveQuestion(){
      const qText = document.getElementById('editQuestionText').value.trim();
      if(!qText){
        alert('Question text is required');
        return;
      }
      
      const editor = document.getElementById('choiceEditor');
      const rows = editor.querySelectorAll('.choiceRow');
      
      const choices = [];
      let correctIdx = -1;
      
      rows.forEach((row, i) => {
        const input = row.querySelector('input[type="text"]');
        const radio = row.querySelector('input[type="radio"]');
        
        const text = input.value.trim();
        if(text){
          choices.push(text);
          if(radio.checked) correctIdx = choices.length - 1;
        }
      });
      
      if(choices.length < 2){
        alert('Need at least 2 choices');
        return;
      }
      
      if(correctIdx === -1){
        alert('Please mark one answer as correct');
        return;
      }
      
      if(editingId){
        const q = questions.find(x => x.id === editingId);
        q.q = qText;
        q.c = choices;
        q.a = correctIdx;
      } else {
        questions.push({
          id: 'q' + Date.now(),
          q: qText,
          c: choices,
          a: correctIdx
        });
      }
      
      localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(questions));
      
      cancelEdit();
      refreshQuestionsList();
    }

    function cancelEdit(){
      document.getElementById('editorForm').classList.remove('active');
      editingId = null;
    }

    function deleteCurrentQuestion(){
      if(!editingId) return;
      if(!confirm('Delete this question?')) return;
      
      questions = questions.filter(q => q.id !== editingId);
      localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(questions));
      
      cancelEdit();
      refreshQuestionsList();
    }

    function resetToDefaults(){
      if(!confirm('Reset to default questions? This will delete all custom questions.')) return;
      
      localStorage.removeItem('handsPlease_quiz_v5');
      location.reload();
    }

    function exportQuestions(){
      const json = JSON.stringify(questions, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'quiz-questions.json';
      a.click();
    }

    function importQuestions(){
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      
      input.onchange = (e) => {
        const file = e.target.files[0];
        if(!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            if(!Array.isArray(imported)){
              alert('Invalid format');
              return;
            }
            
            questions = imported;
            localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(questions));
            refreshQuestionsList();
            alert('Import successful!');
          } catch(err){
            alert('Error parsing JSON');
          }
        };
        reader.readAsText(file);
      };
      
      input.click();
    }

    init();
  </script>
</body>
</html>
