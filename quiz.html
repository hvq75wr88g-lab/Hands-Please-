<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Breakfast Quiz - Hands Please</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800;900&family=Space+Mono:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-deep: #0b1120;
      --bg-card: rgba(15, 23, 50, 0.75);
      --bg-card-solid: #111d3a;
      --bg-surface: rgba(20, 30, 60, 0.6);
      --glass-border: rgba(212, 175, 55, 0.18);
      --glass-glow: rgba(212, 175, 55, 0.06);
      --ink: #e8e4df;
      --ink-muted: #8a93a8;
      --accent: #d4af37;
      --accent-bright: #f5d76e;
      --danger: #ef4444;
      --danger-glow: rgba(239,68,68,0.35);
      --ok: #22c55e;
      --ok-glow: rgba(34,197,94,0.3);
      --gold: #f5d76e;
      --streak-warm: linear-gradient(135deg, #f97316, #f59e0b);
      --streak-hot: linear-gradient(135deg, #ef4444, #f97316);
    }

```
*{ box-sizing: border-box; margin: 0; padding: 0; }

html, body{
  height: 100%;
  overflow: hidden;
  -webkit-tap-highlight-color: transparent;
}

body{
  background: var(--bg-deep);
  background-image:
    radial-gradient(ellipse at 20% 50%, rgba(212,175,55,0.04) 0%, transparent 60%),
    radial-gradient(ellipse at 80% 20%, rgba(100,120,200,0.05) 0%, transparent 50%),
    radial-gradient(circle, rgba(212,175,55,0.03) 1px, transparent 1px);
  background-size: 100% 100%, 100% 100%, 24px 24px;
  font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--ink);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px;
}

/* =====================================================
   LAYOUT
   ===================================================== */
.mainContainer{
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 36px;
  max-width: 1400px;
  width: 100%;
  height: 100%;
}

/* =====================================================
   EGGS HUD
   ===================================================== */
.eggsHUD{ display: flex; flex-direction: column; gap: 26px; align-items: center; }
.eggsInline{ display: none; gap: 8px; align-items: center; }
.eggsInline .egg{ width: 36px; height: 44px; border-width: 1.5px; }
.eggsInline .egg::after{ top: 8px; left: 8px; width: 7px; height: 9px; }

.egg{
  width: 74px;
  height: 92px;
  background: linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
  border: 2px solid rgba(212,175,55,0.25);
  border-radius: 50% 50% 45% 45%;
  box-shadow: 0 6px 18px rgba(0,0,0,0.4), inset 0 2px 0 rgba(255,255,255,0.1);
  position: relative;
  transition: all 0.3s ease;
  overflow: visible;
}

.egg::after{
  content: '';
  position: absolute;
  top: 18px;
  left: 18px;
  width: 14px;
  height: 18px;
  background: rgba(255,255,255,0.12);
  border-radius: 50%;
  transform: rotate(-30deg);
}

/* Cracked state: hide the original egg, show halves via JS children */
.egg.cracked{
  background: transparent !important;
  border-color: transparent !important;
  box-shadow: none !important;
}

.egg.cracked::after{ display: none; }

/* Egg half shells ‚Äî visible with good contrast */
.eggHalf{
  position: absolute;
  width: 100%;
  height: 55%;
  background: linear-gradient(145deg, rgba(245,240,230,0.35), rgba(230,220,200,0.2));
  border: 2px solid rgba(212,195,160,0.5);
  overflow: hidden;
}

.eggHalf::after{
  content: '';
  position: absolute;
  width: 8px; height: 10px;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  transform: rotate(-30deg);
}

.eggHalf.top{
  top: 0; left: 0;
  border-radius: 50% 50% 10% 30%;
  transform-origin: bottom left;
  animation: eggHalfFallLeft 0.8s cubic-bezier(0.4,0,0.8,0.6) forwards;
}
.eggHalf.top::after{ top: 10px; left: 12px; }

.eggHalf.bottom{
  bottom: 0; right: 0;
  border-radius: 30% 10% 45% 45%;
  transform-origin: bottom right;
  animation: eggHalfFallRight 0.8s cubic-bezier(0.4,0,0.8,0.6) forwards;
}
.eggHalf.bottom::after{ top: 6px; right: 10px; left: auto; }

/* Inner shell surface (slightly different shade for realism) */
.eggHalf.top .innerShell,
.eggHalf.bottom .innerShell{
  position: absolute;
  inset: 2px;
  background: linear-gradient(180deg, rgba(255,250,240,0.1), rgba(240,235,220,0.05));
  border-radius: inherit;
}

/* Jagged edge on the crack line */
.eggHalf.top::before{
  content: '';
  position: absolute;
  bottom: -4px; left: -2px; right: -2px; height: 10px;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 74 10"><path d="M0 5 L8 1 L15 7 L22 2 L30 8 L37 1 L44 6 L52 2 L60 7 L67 1 L74 5" stroke="rgba(220,210,190,0.6)" stroke-width="2" fill="none"/></svg>') no-repeat;
  background-size: 100% 100%;
}

.eggHalf.bottom::before{
  content: '';
  position: absolute;
  top: -4px; left: -2px; right: -2px; height: 10px;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 74 10"><path d="M0 5 L8 9 L15 3 L22 8 L30 2 L37 9 L44 4 L52 8 L60 3 L67 9 L74 5" stroke="rgba(220,210,190,0.6)" stroke-width="2" fill="none"/></svg>') no-repeat;
  background-size: 100% 100%;
}

@keyframes eggHalfFallLeft{
  0%  { transform: rotate(0deg) translate(0,0); opacity: 1; }
  25% { transform: rotate(-18deg) translate(-4px, 3px); }
  50% { transform: rotate(-40deg) translate(-14px, 16px); opacity: 1; }
  75% { transform: rotate(-52deg) translate(-20px, 22px); }
  90% { transform: rotate(-48deg) translate(-18px, 28px); opacity: 0.7; }
  100%{ transform: rotate(-50deg) translate(-20px, 30px); opacity: 0.5; }
}

@keyframes eggHalfFallRight{
  0%  { transform: rotate(0deg) translate(0,0); opacity: 1; }
  25% { transform: rotate(15deg) translate(3px, 3px); }
  50% { transform: rotate(35deg) translate(12px, 14px); opacity: 1; }
  75% { transform: rotate(48deg) translate(18px, 20px); }
  90% { transform: rotate(44deg) translate(16px, 26px); opacity: 0.7; }
  100%{ transform: rotate(46deg) translate(18px, 28px); opacity: 0.5; }
}

/* Yolk blob ‚Äî realistic with gloss and shadow */
.eggYolk{
  position: absolute;
  width: 30px;
  height: 28px;
  background: radial-gradient(ellipse at 35% 30%, #ffe066 0%, #f5c518 35%, #e6a817 55%, #cc8800 80%, #b37300 100%);
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  z-index: 5;
  animation: yolkAppear 0.8s 0.15s cubic-bezier(0.34,1.56,0.64,1) forwards;
  box-shadow: 
    0 4px 12px rgba(180,120,0,0.5),
    inset 0 -4px 8px rgba(150,80,0,0.3),
    inset 0 2px 4px rgba(255,240,150,0.5);
}

/* Yolk highlight / gloss */
.eggYolk::after{
  content: '';
  position: absolute;
  top: 4px;
  left: 7px;
  width: 10px;
  height: 7px;
  background: radial-gradient(ellipse, rgba(255,255,230,0.7) 0%, rgba(255,255,200,0.3) 50%, transparent 100%);
  border-radius: 50%;
  transform: rotate(-25deg);
}

/* Secondary yolk highlight */
.eggYolk::before{
  content: '';
  position: absolute;
  top: 3px;
  right: 8px;
  width: 5px;
  height: 4px;
  background: rgba(255,255,220,0.4);
  border-radius: 50%;
}

@keyframes yolkAppear{
  0%  { transform: translate(-50%, -50%) scale(0); }
  40% { transform: translate(-50%, -35%) scale(1.2); }
  55% { transform: translate(-50%, -25%) scale(0.9, 1.05); }
  70% { transform: translate(-50%, -20%) scale(1.05, 0.95); }
  85% { transform: translate(-50%, -18%) scale(0.98, 1.02); }
  100%{ transform: translate(-50%, -15%) scale(1); }
}

/* Egg white puddle ‚Äî gooey and irregular */
.eggWhite{
  position: absolute;
  width: 56px;
  height: 28px;
  bottom: -18px;
  left: 50%;
  transform: translateX(-50%) scaleX(0);
  z-index: 3;
  animation: whiteSpread 1s 0.2s ease-out forwards;
  background: none;
}

/* Main white blob */
.eggWhite::before{
  content: '';
  position: absolute;
  width: 48px;
  height: 22px;
  background: radial-gradient(ellipse at 50% 40%, 
    rgba(255,255,255,0.28) 0%, 
    rgba(240,245,250,0.18) 40%, 
    rgba(220,230,240,0.08) 70%, 
    transparent 100%);
  border-radius: 60% 40% 50% 45%;
  top: 0;
  left: 2px;
  border: 1px solid rgba(255,255,255,0.08);
}

/* Secondary drool extension */
.eggWhite::after{
  content: '';
  position: absolute;
  width: 30px;
  height: 16px;
  background: radial-gradient(ellipse at 40% 50%, 
    rgba(255,255,255,0.2) 0%, 
    rgba(235,240,245,0.1) 50%, 
    transparent 100%);
  border-radius: 45% 55% 50% 50%;
  top: -4px;
  right: -6px;
  transform: rotate(12deg);
}

@keyframes whiteSpread{
  0%  { transform: translateX(-50%) scaleX(0) scaleY(0.3); opacity: 0; }
  30% { transform: translateX(-50%) scaleX(0.8) scaleY(0.7); opacity: 1; }
  60% { transform: translateX(-50%) scaleX(1.15) scaleY(1.05); }
  80% { transform: translateX(-50%) scaleX(1.25) scaleY(0.95); }
  100%{ transform: translateX(-50%) scaleX(1.2) scaleY(1); opacity: 0.9; }
}

/* Drip from crack ‚Äî realistic egg drip */
.eggDrip{
  position: absolute;
  width: 8px;
  background: linear-gradient(to bottom, 
    rgba(255,255,240,0.35), 
    rgba(255,240,180,0.25),
    rgba(245,215,110,0.15));
  border-radius: 0 0 50% 50%;
  z-index: 4;
  animation: dripFall 1.5s 0.25s ease-in forwards;
  opacity: 0;
}

.eggDrip.left{ left: 6px; top: 50%; height: 0; }
.eggDrip.right{ right: 8px; top: 45%; height: 0; }

/* Drip droplet at tip */
.eggDrip::after{
  content: '';
  position: absolute;
  bottom: -3px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 8px;
  background: radial-gradient(ellipse, rgba(255,250,220,0.3) 0%, transparent 70%);
  border-radius: 50%;
}

@keyframes dripFall{
  0%  { height: 0; opacity: 0; }
  10% { height: 3px; opacity: 0.8; }
  40% { height: 16px; opacity: 0.7; }
  65% { height: 28px; opacity: 0.5; }
  85% { height: 34px; opacity: 0.3; }
  100%{ height: 38px; opacity: 0; }
}

/* =====================================================
   QUIZ CARD ‚Äî GLASSMORPHISM
   ===================================================== */
.quizCard{
  width: 100%;
  max-width: 600px;
  background: var(--bg-card);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  padding: 22px 24px 18px;
  box-shadow:
    0 8px 32px rgba(0,0,0,0.4),
    inset 0 1px 0 rgba(212,175,55,0.08);
  position: relative;
  overflow: hidden;
}

.quizCard::before{
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
  opacity: 0.3;
}

/* =====================================================
   1. XP PROGRESS BAR (replaces Q counter)
   ===================================================== */
.xpBarWrap{
  position: relative;
  height: 6px;
  background: rgba(255,255,255,0.06);
  border-radius: 3px;
  margin-bottom: 14px;
  overflow: hidden;
}

.xpBarFill{
  height: 100%;
  border-radius: 3px;
  width: 0%;
  background: linear-gradient(90deg, var(--accent), var(--accent-bright));
  transition: width 0.6s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: 0 0 8px rgba(212,175,55,0.4);
}

.xpLabel{
  position: absolute;
  right: 0;
  top: -18px;
  font-size: 11px;
  font-weight: 700;
  color: var(--ink-muted);
  letter-spacing: 0.5px;
}

/* =====================================================
   QUIZ HEADER
   ===================================================== */
.quizHeader{
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
  font-size: 13px;
  font-weight: 700;
  color: var(--ink-muted);
}

/* =====================================================
   TIMER ‚Äî CLEAN LAYOUT
   ===================================================== */
.timerWrap{
  position: relative;
  height: 5px;
  background: rgba(255,255,255,0.06);
  border-radius: 3px;
  margin-bottom: 12px;
  overflow: visible;
}

.timerBar{
  height: 100%;
  border-radius: 3px;
  width: 100%;
  transition: width 0.1s linear, background-color 0.5s;
  background: var(--ok);
}

.timerCount{
  position: absolute;
  right: 0;
  top: 8px;
  font-size: 12px;
  font-weight: 700;
  font-family: 'Space Mono', monospace;
  color: var(--ink-muted);
  transition: color 0.3s;
}

/* =====================================================
   STREAK BADGE
   ===================================================== */
.streakBadge{
  display: none;
  background: var(--streak-warm);
  color: white;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  animation: streakPulse 0.8s ease-in-out infinite alternate;
}

.streakBadge.hot{
  background: var(--streak-hot);
}

@keyframes streakPulse{
  from{ transform: scale(1); }
  to{ transform: scale(1.06); }
}

/* =====================================================
   SCORE POPUP
   ===================================================== */
.scorePopup{
  position: absolute;
  right: 24px;
  top: 50px;
  background: linear-gradient(135deg, var(--ok), #34d399);
  color: white;
  padding: 8px 14px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 700;
  text-align: center;
  pointer-events: none;
  animation: floatUp 1.3s ease-out forwards;
  z-index: 50;
  box-shadow: 0 4px 20px var(--ok-glow);
  line-height: 1.4;
  white-space: nowrap;
}

@keyframes floatUp{
  0%  { opacity: 1; transform: translateY(0) scale(1); }
  20% { opacity: 1; transform: translateY(-12px) scale(1.05); }
  100%{ opacity: 0; transform: translateY(-70px) scale(0.9); }
}

/* =====================================================
   ANSWER HIGHLIGHTS
   ===================================================== */
.choice.correct-highlight{
  border-color: var(--ok) !important;
  background: rgba(34,197,94,0.12) !important;
  transform: none !important;
}

.choice.wrong-highlight{
  border-color: var(--danger) !important;
  background: rgba(239,68,68,0.12) !important;
  transform: none !important;
}

.quizTitle{
  text-align: center;
  font-size: 17px;
  font-weight: 800;
  color: var(--accent);
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.playerName{
  text-align: center;
  font-size: 13px;
  color: var(--accent-bright);
  margin-bottom: 10px;
  font-weight: 600;
  opacity: 0.7;
}

.questionText{
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 14px;
  line-height: 1.4;
  color: var(--ink);
}

.choices{
  display: grid;
  gap: 8px;
  margin-bottom: 10px;
}

.choice{
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 14px;
  border: 1.5px solid rgba(255,255,255,0.08);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 15px;
  background: rgba(255,255,255,0.03);
  color: var(--ink);
}

.choice:hover{
  border-color: var(--accent);
  background: rgba(212,175,55,0.06);
  transform: translateX(4px);
}

.choice:has(input:checked){
  border-color: var(--accent) !important;
  background: rgba(212,175,55,0.1) !important;
  transform: translateX(4px);
}

.choice input{
  width: 18px;
  height: 18px;
  accent-color: var(--accent);
  flex-shrink: 0;
}

/* ELIMINATED CHOICE (Spotlight power-up) */
.choice.eliminated{
  opacity: 0.2;
  pointer-events: none;
  text-decoration: line-through;
  filter: grayscale(1);
}

.submitBtn{
  width: 100%;
  padding: 13px;
  background: linear-gradient(135deg, var(--accent), #c9a030);
  color: var(--bg-deep);
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 800;
  cursor: pointer;
  transition: 0.2s;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}

.submitBtn:hover{ background: linear-gradient(135deg, var(--accent-bright), var(--accent)); }
.submitBtn:disabled{ opacity: 0.35; cursor: not-allowed; }
.submitBtn:active:not(:disabled){ transform: scale(0.97); }

.feedback{
  text-align: center;
  margin-top: 8px;
  font-size: 14px;
  font-weight: 700;
  min-height: 20px;
}

/* =====================================================
   4. POWER-UPS
   ===================================================== */
.powerUpsRow{
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  justify-content: center;
}

.powerUpBtn{
  padding: 7px 14px;
  border: 1.5px solid rgba(212,175,55,0.25);
  border-radius: 8px;
  background: rgba(212,175,55,0.06);
  color: var(--accent-bright);
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  font-family: inherit;
}

.powerUpBtn:hover:not(:disabled){
  background: rgba(212,175,55,0.15);
  border-color: var(--accent);
  transform: translateY(-1px);
}

.powerUpBtn:disabled{
  opacity: 0.25;
  cursor: not-allowed;
  filter: grayscale(1);
}

.powerUpBtn.used{
  opacity: 0.2;
  text-decoration: line-through;
}

/* =====================================================
   9. STREAK MILESTONE BANNER
   ===================================================== */
.streakBanner{
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  z-index: 60;
  text-align: center;
  padding: 14px;
  font-size: 20px;
  font-weight: 900;
  color: white;
  text-shadow: 0 2px 8px rgba(0,0,0,0.5);
  letter-spacing: 1px;
  pointer-events: none;
  animation: bannerFlash 1.8s ease-out forwards;
}

.streakBanner.fire3{
  background: linear-gradient(135deg, rgba(249,115,22,0.92), rgba(245,158,11,0.92));
  box-shadow: 0 0 40px rgba(249,115,22,0.5);
}

.streakBanner.fire5{
  background: linear-gradient(135deg, rgba(239,68,68,0.92), rgba(249,115,22,0.92));
  box-shadow: 0 0 40px rgba(239,68,68,0.5);
}

@keyframes bannerFlash{
  0%  { opacity: 0; transform: translateY(-50%) scaleX(0.3); }
  15% { opacity: 1; transform: translateY(-50%) scaleX(1.05); }
  25% { transform: translateY(-50%) scaleX(1); }
  70% { opacity: 1; }
  100%{ opacity: 0; transform: translateY(-50%) scaleX(1); }
}

/* =====================================================
   3. SCREEN SHAKE ON WRONG/TIMEOUT
   ===================================================== */
.quizCard.screen-shake{
  animation: screenShake 0.4s ease-out;
}

@keyframes screenShake{
  0%  { transform: translateX(0); }
  10% { transform: translateX(-8px) rotate(-0.5deg); }
  20% { transform: translateX(7px) rotate(0.5deg); }
  30% { transform: translateX(-6px) rotate(-0.3deg); }
  40% { transform: translateX(5px) rotate(0.3deg); }
  50% { transform: translateX(-3px); }
  60% { transform: translateX(2px); }
  70% { transform: translateX(-1px); }
  100%{ transform: translateX(0); }
}

/* =====================================================
   10. SMOOTH QUESTION TRANSITIONS
   ===================================================== */
.questionArea{
  position: relative;
}

@keyframes slideOutLeft{
  from{ opacity: 1; transform: translateX(0); }
  to  { opacity: 0; transform: translateX(-40px); }
}

@keyframes slideInRight{
  from{ opacity: 0; transform: translateX(40px); }
  to  { opacity: 1; transform: translateX(0); }
}

.questionArea.slide-out{
  animation: slideOutLeft 0.25s ease-in forwards;
}

.questionArea.slide-in{
  animation: slideInRight 0.3s ease-out forwards;
}

/* =====================================================
   2. CONFETTI BURST (on correct / streaks)
   ===================================================== */
.confettiPiece{
  position: fixed;
  top: -20px;
  border-radius: 3px;
  pointer-events: none;
  z-index: 9999;
  animation: confettiFall linear both;
}

@keyframes confettiFall{
  0%  { transform: translateY(0) rotate(0deg); opacity: 1; }
  25% { transform: translateY(25vh) rotate(180deg) scaleX(-1); }
  50% { transform: translateY(55vh) rotate(360deg) scaleX(1); }
  75% { transform: translateY(80vh) rotate(540deg) scaleX(-1); }
  100%{ transform: translateY(115vh) rotate(720deg); opacity: 0; }
}

/* Mini confetti burst from score popup area */
.miniConfetti{
  position: absolute;
  width: 5px;
  height: 5px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 55;
  animation: miniPop 0.8s ease-out forwards;
}

@keyframes miniPop{
  0%  { opacity: 1; transform: translate(0,0) scale(1); }
  100%{ opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0.3); }
}

/* =====================================================
   CHICKEN STAGE
   ===================================================== */
.chickenStage{
  display: flex;
  align-items: center;
  justify-content: center;
  width: 280px;
  height: 280px;
  position: relative;
}

.chickenImage{
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: none;
}

.chickenImage.active{ display: block; }

body.happy .chickenImage.happy{
  display: block;
  animation: bounceChicken 0.6s ease-in-out infinite alternate;
}

body.angry .chickenImage.angry{
  display: block;
  animation: shakeChicken 0.12s linear infinite;
}

body.wink .chickenImage.wink{
  display: block;
  animation: breatheChicken 3s ease-in-out infinite;
}

body.peck .chickenImage.angry{
  display: block;
  animation: peckChicken 0.5s ease-in-out infinite;
}

@keyframes bounceChicken{
  from{ transform: translateY(0); }
  to{ transform: translateY(-30px); }
}

@keyframes shakeChicken{
  0%{ transform: translate(2px, 1px) rotate(0deg); }
  25%{ transform: translate(-2px, -2px) rotate(-1deg); }
  50%{ transform: translate(2px, 2px) rotate(1deg); }
  75%{ transform: translate(-2px, 1px) rotate(-1deg); }
  100%{ transform: translate(2px, -1px) rotate(0deg); }
}

@keyframes breatheChicken{
  0%, 100%{ transform: scale(1); }
  50%{ transform: scale(1.03); }
}

@keyframes peckChicken{
  0%{ transform: scale(1) translateY(0); }
  50%{ transform: scale(1.5) translateY(30px); }
  100%{ transform: scale(1) translateY(0); }
}

/* =====================================================
   NAME ENTRY SCREEN ‚Äî DARK THEME
   ===================================================== */
.nameEntryScreen{
  position: fixed;
  inset: 0;
  background: var(--bg-deep);
  background-image:
    radial-gradient(ellipse at 50% 40%, rgba(212,175,55,0.06) 0%, transparent 60%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 500;
  padding: 20px;
}

.nameEntryCard{
  background: var(--bg-card);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  padding: 40px;
  max-width: 460px;
  width: 100%;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  animation: nameCardDrop 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
}

@keyframes nameCardDrop{
  0%  { opacity: 0; transform: translateY(-60px) scale(0.9); }
  60% { transform: translateY(10px) scale(1.02); }
  80% { transform: translateY(-5px) scale(0.99); }
  100%{ opacity: 1; transform: translateY(0) scale(1); }
}

.nameEntryCard h2{
  font-size: 28px;
  font-weight: 900;
  color: var(--accent);
  margin-bottom: 8px;
}

.nameEntryCard p{
  font-size: 15px;
  color: var(--ink-muted);
  margin-bottom: 28px;
}

.nameEntryCard input{
  width: 100%;
  padding: 14px;
  font-size: 17px;
  border: 1.5px solid rgba(255,255,255,0.1);
  border-radius: 10px;
  margin-bottom: 16px;
  font-family: inherit;
  background: rgba(255,255,255,0.04);
  color: var(--ink);
}

.nameEntryCard input:focus{
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(212,175,55,0.15);
}

.nameEntryCard input::placeholder{
  color: var(--ink-muted);
}

/* =====================================================
   GAME OVER POPUP ‚Äî DARK
   ===================================================== */
.gameOverPopup{
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 450px;
  background: var(--bg-card-solid);
  border: 2px solid var(--danger);
  border-radius: 20px;
  padding: 36px 28px;
  text-align: center;
  box-shadow: 0 40px 80px rgba(0,0,0,0.6), 0 0 60px var(--danger-glow);
  z-index: 100;
  display: none;
}

.gameOverPopup h2{
  font-size: 30px;
  font-weight: 900;
  color: var(--danger);
  margin-bottom: 12px;
}

.gameOverPopup p{
  font-size: 15px;
  margin-bottom: 8px;
  color: var(--ink-muted);
}

.gameOverPopup .endRank{
  font-size: 22px;
  font-weight: 800;
  color: var(--accent);
  margin: 12px 0;
}

.gameOverPopup .statsGrid{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 16px 0;
  text-align: center;
}

.statBox{
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 10px;
  padding: 10px 8px;
}

.statBox .statVal{
  font-size: 22px;
  font-weight: 800;
  color: var(--accent-bright);
}

.statBox .statLabel{
  font-size: 11px;
  color: var(--ink-muted);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 2px;
}

.gameOverPopup button{
  margin-top: 16px;
  padding: 14px 36px;
  background: linear-gradient(135deg, var(--accent), #c9a030);
  color: var(--bg-deep);
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 800;
  cursor: pointer;
  font-family: inherit;
}

/* =====================================================
   VICTORY POPUP ‚Äî DARK
   ===================================================== */
.victoryPopup{
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 480px;
  background: var(--bg-card-solid);
  border: 2px solid var(--ok);
  border-radius: 20px;
  padding: 36px 28px;
  text-align: center;
  box-shadow: 0 40px 80px rgba(0,0,0,0.6), 0 0 60px var(--ok-glow);
  z-index: 100;
  display: none;
}

.victoryPopup h2{
  font-size: 30px;
  font-weight: 900;
  color: var(--ok);
  margin-bottom: 10px;
}

.victoryPopup .finalScore{
  font-size: 44px;
  font-weight: 900;
  color: var(--gold);
  margin: 14px 0 6px;
  font-family: 'Space Mono', monospace;
}

.victoryPopup .endRank{
  font-size: 20px;
  font-weight: 800;
  color: var(--accent-bright);
  margin: 8px 0 14px;
}

.victoryPopup p{
  font-size: 15px;
  margin-bottom: 8px;
  color: var(--ink-muted);
}

.victoryPopup .statsGrid{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 16px 0;
}

.victoryPopup button{
  margin-top: 14px;
  padding: 14px 32px;
  background: linear-gradient(135deg, var(--ok), #16a34a);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 800;
  cursor: pointer;
  margin-right: 8px;
  font-family: inherit;
}

/* =====================================================
   LEADERBOARD ‚Äî DARK
   ===================================================== */
.leaderboardBtn{
  position: fixed;
  top: 10px;
  left: 10px;
  padding: 9px 18px;
  background: linear-gradient(135deg, var(--accent), #c9a030);
  color: var(--bg-deep);
  border: none;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 800;
  cursor: pointer;
  z-index: 200;
  box-shadow: 0 4px 16px rgba(212,175,55,0.3);
  font-family: inherit;
}

.leaderboardBtn:hover{ background: linear-gradient(135deg, var(--accent-bright), var(--accent)); }

.musicToggleBtn{
  position: fixed;
  top: 10px;
  left: 145px;
  padding: 9px 14px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(212,175,55,0.2);
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  z-index: 200;
  transition: 0.2s;
  color: var(--ink);
  line-height: 1;
}

.musicToggleBtn:hover{ background: rgba(255,255,255,0.1); }

.leaderboardModal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.88);
  backdrop-filter: blur(8px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 300;
  overflow-y: auto;
  padding: 20px;
}

.leaderboardPanel{
  background: var(--bg-card-solid);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  width: 100%;
  max-width: 550px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
}

.leaderboardHeader{
  padding: 18px 20px;
  border-bottom: 1px solid rgba(212,175,55,0.15);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(200,160,48,0.08));
  border-radius: 16px 16px 0 0;
}

.leaderboardHeader h2{
  font-size: 22px;
  font-weight: 900;
  color: var(--accent);
}

.leaderboardBody{
  padding: 16px;
  overflow-y: auto;
  flex: 1;
}

.leaderboardList{
  display: grid;
  gap: 8px;
}

.leaderboardItem{
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 12px 14px;
  background: rgba(255,255,255,0.03);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.05);
  transition: 0.2s;
}

/* 8. LEADERBOARD MEDALS */
.leaderboardItem.medal-gold{
  background: linear-gradient(135deg, rgba(212,175,55,0.12), rgba(245,215,110,0.06));
  border-color: rgba(212,175,55,0.3);
}

.leaderboardItem.medal-silver{
  background: linear-gradient(135deg, rgba(192,192,192,0.1), rgba(220,220,220,0.04));
  border-color: rgba(192,192,192,0.25);
}

.leaderboardItem.medal-bronze{
  background: linear-gradient(135deg, rgba(205,127,50,0.1), rgba(205,127,50,0.04));
  border-color: rgba(205,127,50,0.25);
}

.leaderboardItem.champion{
  position: relative;
  overflow: hidden;
}

.leaderboardItem.champion::before{
  content: 'üëë';
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 28px;
  opacity: 0.15;
}

.leaderboardRank{
  font-size: 22px;
  font-weight: 800;
  color: var(--accent);
  min-width: 40px;
  text-align: center;
}

.leaderboardInfo{
  flex: 1;
}

.leaderboardName{
  font-size: 16px;
  font-weight: 700;
  color: var(--ink);
  margin-bottom: 3px;
}

.leaderboardItem.champion .leaderboardName{
  color: var(--gold);
  font-size: 17px;
}

.leaderboardItem.champion .leaderboardName::after{
  content: ' üèÜ Breakfast Champion!';
  font-size: 12px;
  color: var(--accent);
  font-weight: 600;
}

.leaderboardDate{
  font-size: 11px;
  color: var(--ink-muted);
}

.leaderboardScore{
  font-size: 24px;
  font-weight: 800;
  color: var(--ok);
  font-family: 'Space Mono', monospace;
}

.emptyLeaderboard{
  text-align: center;
  padding: 40px 20px;
  color: var(--ink-muted);
}

.emptyLeaderboard p{
  font-size: 16px;
  margin-bottom: 8px;
}

/* =====================================================
   ADMIN ‚Äî DARK
   ===================================================== */
.adminLink{
  position: fixed;
  bottom: 10px;
  right: 10px;
  font-size: 11px;
  color: var(--ink-muted);
  text-decoration: none;
  background: rgba(255,255,255,0.04);
  padding: 5px 10px;
  border-radius: 6px;
  z-index: 200;
}

.adminLink:hover{ color: var(--accent); }

.adminModal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.88);
  backdrop-filter: blur(8px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 400;
  overflow-y: auto;
  padding: 20px;
}

.adminPanel{
  background: var(--bg-card-solid);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  width: 100%;
  max-width: 700px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
}

.adminHeader{
  padding: 18px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.adminHeader h2{
  color: var(--accent);
  font-size: 22px;
  font-weight: 900;
}

.adminTabs{
  display: flex;
  gap: 8px;
  padding: 12px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.02);
}

.adminTab{
  padding: 8px 18px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  transition: 0.2s;
  color: var(--ink-muted);
  font-family: inherit;
}

.adminTab.active{
  background: linear-gradient(135deg, var(--accent), #c9a030);
  color: var(--bg-deep);
  border-color: var(--accent);
}

.adminBody{
  padding: 20px;
  overflow-y: auto;
  flex: 1;
}

.adminSection{ display: none; }
.adminSection.active{ display: block; }

.adminControls{
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.btnAdmin{
  padding: 10px 18px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.2s;
  font-family: inherit;
}

.btnPrimary{ background: linear-gradient(135deg, var(--accent), #c9a030); color: var(--bg-deep); }
.btnPrimary:hover{ filter: brightness(1.1); }
.btnSecondary{ background: rgba(255,255,255,0.06); color: var(--ink); border: 1px solid rgba(255,255,255,0.08); }
.btnSecondary:hover{ background: rgba(255,255,255,0.1); }
.btnDanger{ background: var(--danger); color: white; }
.btnDanger:hover{ background: #dc2626; }

.questionsList{
  display: grid;
  gap: 12px;
  margin-bottom: 16px;
}

.qCard{
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 10px;
  padding: 14px;
  background: rgba(255,255,255,0.03);
}

.qCard .qText{
  font-weight: 700;
  margin-bottom: 8px;
  font-size: 14px;
  color: var(--ink);
}

.qCard .qChoices{
  font-size: 13px;
  color: var(--ink-muted);
  margin-bottom: 8px;
  padding-left: 10px;
}

.qCard .qChoices div{ margin: 4px 0; }
.qCard .qChoices .correct{ color: var(--ok); font-weight: 700; }

.qCard .qActions{
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.editorForm{
  display: none;
  background: rgba(212,175,55,0.05);
  border: 1px solid rgba(212,175,55,0.2);
  border-radius: 12px;
  padding: 18px;
  margin-bottom: 16px;
}

.editorForm.active{ display: block; }

.formField{ margin-bottom: 14px; }

.formField label{
  display: block;
  font-weight: 700;
  margin-bottom: 4px;
  font-size: 13px;
  color: var(--ink);
}

.formField input[type="text"],
.formField textarea,
.formField input[type="password"]{
  width: 100%;
  padding: 10px;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  font-size: 14px;
  font-family: inherit;
  background: rgba(255,255,255,0.04);
  color: var(--ink);
}

.formField input:focus,
.formField textarea:focus{
  outline: none;
  border-color: var(--accent);
}

.formField textarea{ min-height: 70px; resize: vertical; }

.choiceEditor{ display: grid; gap: 8px; }

.choiceRow{
  display: flex;
  gap: 8px;
  align-items: center;
}

.choiceRow input[type="text"]{
  flex: 1;
  padding: 8px;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  font-size: 13px;
  background: rgba(255,255,255,0.04);
  color: var(--ink);
}

.choiceRow input[type="radio"]{
  width: 18px;
  height: 18px;
  accent-color: var(--ok);
}

.choiceRow button{
  padding: 6px 10px;
  background: var(--danger);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
}

.formActions{
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.leaderboardAdminList{ display: grid; gap: 8px; }

.leaderboardAdminItem{
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 10px 12px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 10px;
}

.leaderboardAdminItem.champion{
  background: rgba(212,175,55,0.08);
  border-color: rgba(212,175,55,0.2);
}

.leaderboardAdminInfo{ flex: 1; }
.leaderboardAdminName{ font-weight: 700; font-size: 15px; color: var(--ink); }
.leaderboardAdminDate{ font-size: 11px; color: var(--ink-muted); }
.leaderboardAdminScore{ font-size: 18px; font-weight: 800; color: var(--ok); margin-right: 8px; }

/* =====================================================
   EGG SHATTER
   ===================================================== */
/* Egg initial shake before crack */
.egg.shattering{
  animation: eggPreCrackShake 0.5s ease-out;
}

@keyframes eggPreCrackShake{
  0%  { transform: rotate(0deg); }
  15% { transform: rotate(-6deg) scale(1.05); }
  30% { transform: rotate(5deg) scale(1.08); }
  45% { transform: rotate(-4deg) scale(1.03); }
  60% { transform: rotate(3deg); }
  75% { transform: rotate(-2deg); }
  90% { transform: rotate(1deg); }
  100%{ transform: rotate(0deg); }
}

/* TIMER HEARTBEAT */
.timerBar.heartbeat{
  animation: timerHeartbeat 0.55s ease-in-out infinite;
}

@keyframes timerHeartbeat{
  0%,100%{ opacity: 1; }
  15%    { opacity: 0.3; }
  30%    { opacity: 1; }
  48%    { opacity: 0.55; }
  64%    { opacity: 1; }
}

.quizCard.urgency{
  animation: cardUrgencyPulse 0.55s ease-in-out infinite;
}

@keyframes cardUrgencyPulse{
  0%,100%{ box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
  50%    { box-shadow: 0 8px 32px rgba(0,0,0,0.4),
                       0 0 0 2px rgba(239,68,68,0.3),
                       0 0 30px var(--danger-glow); }
}

/* CHOICE STAGGER IN */
@keyframes choiceSlideIn{
  from{ opacity: 0; transform: translateX(-24px); }
  to  { opacity: 1; transform: translateX(0); }
}

.choice.stagger-in{
  opacity: 0;
  animation: choiceSlideIn 0.3s ease-out both;
}

/* CORRECT GLOW PULSE */
@keyframes correctGlowPulse{
  0%,100%{ box-shadow: 0 0 0 0 rgba(34,197,94,0); }
  50%    { box-shadow: 0 0 18px 6px var(--ok-glow); }
}

.choice.correct-highlight.glow-pulse{
  animation: correctGlowPulse 0.5s ease-in-out 3;
}

/* SUBMIT RIPPLE */
.ripple{
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.35);
  transform: scale(0);
  animation: rippleExpand 0.65s linear forwards;
  pointer-events: none;
}

@keyframes rippleExpand{
  to{ transform: scale(50); opacity: 0; }
}

/* VICTORY ENTRANCE */
@keyframes victoryEntrance{
  0%  { opacity: 0; transform: translate(-50%,-50%) scale(0.4) rotate(-4deg); }
  55% { transform: translate(-50%,-50%) scale(1.07) rotate(1deg); }
  75% { transform: translate(-50%,-50%) scale(0.97) rotate(-0.5deg); }
  100%{ opacity: 1; transform: translate(-50%,-50%) scale(1) rotate(0deg); }
}

.victoryPopup.celebrating{
  animation: victoryEntrance 0.75s cubic-bezier(0.34,1.56,0.64,1) both;
}

/* GAME OVER ENTRANCE */
@keyframes gameOverShakeIn{
  0%  { opacity: 0; transform: translate(-50%,-50%) scale(0.5); }
  40% { transform: translate(-50%,-50%) scale(1.06) rotate(2deg); }
  60% { transform: translate(-50%,-50%) scale(0.97) rotate(-1.5deg); }
  75% { transform: translate(-50%,-50%) scale(1.02) rotate(1deg); }
  88% { transform: translate(-50%,-50%) scale(0.99) rotate(-0.5deg); }
  100%{ opacity: 1; transform: translate(-50%,-50%) scale(1) rotate(0deg); }
}

.gameOverPopup.entering{
  animation: gameOverShakeIn 0.65s cubic-bezier(0.34,1.56,0.64,1) both;
}

/* CHICKEN ENTRANCE */
@keyframes chickenEntrance{
  0%  { transform: translateX(220px) scale(0.6); opacity: 0; }
  55% { transform: translateX(-18px) scale(1.08); opacity: 1; }
  75% { transform: translateX(10px) scale(0.97); }
  100%{ transform: translateX(0) scale(1); opacity: 1; }
}

.chickenStage.entering{
  animation: chickenEntrance 0.75s cubic-bezier(0.34,1.56,0.64,1) both;
}

/* REMAINING EGGS PULSE */
@keyframes eggAlive{
  0%,100%{ transform: scale(1); }
  50%    { transform: scale(1.04); }
}

.egg:not(.cracked).alive-pulse{
  animation: eggAlive 2s ease-in-out infinite;
}

/* DIMMED choices */
.choice.dimmed{
  opacity: 0.25;
  filter: grayscale(0.4);
}

/* FEEDBACK FADE-IN */
@keyframes feedbackFadeIn{
  from{ opacity: 0; transform: translateY(5px); }
  to  { opacity: 1; transform: translateY(0); }
}

.feedback.reveal{
  animation: feedbackFadeIn 0.25s ease-out both;
}

/* SCORE DISPLAY */
#scoreDisplay{
  font-size: 14px;
  font-weight: 800;
  color: var(--accent);
  font-family: 'Space Mono', monospace;
  transition: color 0.4s;
}

@keyframes scorePop{
  0%  { transform: scale(1); }
  40% { transform: scale(1.25); color: var(--gold); }
  100%{ transform: scale(1); }
}

#scoreDisplay.pop{
  animation: scorePop 0.45s ease-out;
}

.timerBar.danger-glow{
  filter: drop-shadow(0 0 5px var(--danger-glow));
}

/* === MOBILE ‚Äî NO SCROLL, BIGGER TEXT === */
@media (max-width: 1200px) {
  .mainContainer{ gap: 20px; }
  .chickenStage{ width: 230px; height: 230px; }
  .eggsHUD{ gap: 18px; }
  .egg{ width: 64px; height: 80px; }
}

@media (max-width: 900px) {
  html, body{ overflow: hidden; }
  .mainContainer{
    flex-direction: column;
    gap: 0;
    padding: 4px;
    height: auto;
    min-height: 0;
    justify-content: flex-start;
    align-items: stretch;
  }
  /* Hide sidebar eggs & chicken on mobile */
  .eggsHUD{ display: none !important; }
  .chickenStage{ display: none !important; }
  /* Show inline eggs in card header */
  .eggsInline{ display: flex; }
  .eggsInline .egg{ width: 36px; height: 44px; }
  /* Hide title on mobile */
  .quizTitle{ display: none; }
  .playerName{ display: none; }
  /* Card should NOT stretch ‚Äî fit content only */
  .quizCard{
    padding: 14px 16px 12px;
    border-radius: 14px;
    max-width: 100%;
    flex: none;
  }
  .questionArea{ flex: none; }
  .questionText{ font-size: 18px; margin-bottom: 12px; line-height: 1.35; }
  .choice{ font-size: 16px; padding: 13px 14px; gap: 9px; }
  .choice input{ width: 18px; height: 18px; }
  .choices{ gap: 7px; margin-bottom: 10px; }
  .submitBtn{ font-size: 16px; padding: 14px; }
  .feedback{ font-size: 14px; margin-top: 6px; min-height: 18px; }
  .leaderboardBtn{ padding: 7px 14px; font-size: 11px; }
  .musicToggleBtn{ left: 110px; padding: 7px 10px; font-size: 14px; }
  .powerUpsRow{ margin-bottom: 8px; }
  .powerUpBtn{ padding: 6px 10px; font-size: 18px; }
  .powerUpBtn .puLabel{ display: none; }
  .xpBarWrap{ margin-bottom: 10px; }
  .xpLabel{ font-size: 10px; top: -15px; }
  .timerWrap{ margin-bottom: 10px; }
  .timerCount{ font-size: 11px; top: 6px; }
  .quizHeader{ margin-bottom: 4px; }
  .streakBanner{ font-size: 16px; padding: 10px; }
  body{ padding: 6px; align-items: flex-start; padding-top: 45px; }
}

@media (max-width: 400px) {
  .questionText{ font-size: 17px; }
  .choice{ font-size: 15px; padding: 12px 13px; }
  .submitBtn{ padding: 13px; font-size: 15px; }
  .nameEntryCard{ padding: 28px 18px; }
  .gameOverPopup, .victoryPopup{ padding: 24px 18px; }
}

/* === RULES PAGE === */
.rulesScreen{
  position: fixed; inset: 0; background: var(--bg-deep);
  background-image: radial-gradient(ellipse at 50% 30%, rgba(212,175,55,0.06) 0%, transparent 60%);
  display: none; align-items: center; justify-content: center; z-index: 499; padding: 16px; overflow-y: auto;
}
.rulesCard{
  background: var(--bg-card); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
  border: 1px solid var(--glass-border); border-radius: 20px; padding: 28px 24px; max-width: 500px; width: 100%;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: nameCardDrop 0.5s cubic-bezier(0.34,1.56,0.64,1) both;
}
.rulesCard h2{ text-align: center; font-size: 24px; font-weight: 900; color: var(--accent); margin-bottom: 16px; }
.rulesSection{ margin-bottom: 14px; }
.rulesSection h3{ font-size: 13px; font-weight: 800; color: var(--accent-bright); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
.rulesGrid{ display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.ruleBox{ background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); border-radius: 8px; padding: 8px; text-align: center; }
.ruleBox .ruleVal{ font-size: 16px; font-weight: 800; color: var(--accent-bright); }
.ruleBox .ruleLabel{ font-size: 10px; color: var(--ink-muted); margin-top: 2px; }
.lifelineRow{ display: flex; gap: 6px; }
.lifelineBox{ flex: 1; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); border-radius: 8px; padding: 8px 6px; text-align: center; }
.lifelineBox .llIcon{ font-size: 22px; }
.lifelineBox .llName{ font-size: 11px; font-weight: 800; color: var(--ink); margin: 3px 0 1px; }
.lifelineBox .llDesc{ font-size: 9px; color: var(--ink-muted); line-height: 1.3; }
.ranksList{ display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
.rankTag{ padding: 4px 8px; background: rgba(212,175,55,0.08); border: 1px solid rgba(212,175,55,0.15); border-radius: 6px; font-size: 10px; font-weight: 700; color: var(--accent-bright); white-space: nowrap; }

/* === CHICKEN ENHANCEMENTS === */
/* Rage mode */
body.rage .chickenImage.angry{
  display: block;
  animation: rageChicken 0.3s ease-in-out infinite;
  filter: saturate(2) hue-rotate(-20deg) brightness(1.1);
}
@keyframes rageChicken{
  0%{ transform: scale(1.15) rotate(-2deg); }
  25%{ transform: scale(1.2) rotate(2deg); }
  50%{ transform: scale(1.25) rotate(-1deg); }
  75%{ transform: scale(1.2) rotate(1deg); }
  100%{ transform: scale(1.15) rotate(-2deg); }
}
/* Victory dance */
body.victory .chickenImage.happy{
  display: block;
  animation: victoryDance 1s ease-in-out infinite;
}
@keyframes victoryDance{
  0%{ transform: translateY(0) rotate(0) scale(1); }
  15%{ transform: translateY(-20px) rotate(-8deg) scale(1.1); }
  30%{ transform: translateY(0) rotate(8deg) scale(1); }
  45%{ transform: translateY(-25px) rotate(-5deg) scale(1.15); }
  60%{ transform: translateY(0) rotate(5deg) scale(1); }
  75%{ transform: translateY(-15px) scale(1.05); }
  100%{ transform: translateY(0) scale(1); }
}
/* Reaction emojis */
.chickenEmoji{
  position: absolute; font-size: 28px; pointer-events: none; z-index: 20;
  animation: emojiFloat 1.2s ease-out forwards;
}
@keyframes emojiFloat{
  0%{ opacity: 1; transform: translate(0,0) scale(0.5); }
  30%{ opacity: 1; transform: translate(var(--ex), -30px) scale(1.2); }
  100%{ opacity: 0; transform: translate(var(--ex), -80px) scale(0.7); }
}
/* Chicken peek from right edge */
.chickenPeek{
  position: fixed; right: -160px; bottom: 20px; width: 120px; z-index: 501;
  transition: right 0.6s cubic-bezier(0.34,1.56,0.64,1); pointer-events: none;
  visibility: hidden;
}
.chickenPeek.loaded{ visibility: visible; }
.chickenPeek.visible{ right: -25px; }
.chickenPeek img{ width: 100%; transform: scaleX(-1); display: block; }

/* Timer frozen state */
.timerBar.frozen{
  background: #38bdf8 !important;
  filter: drop-shadow(0 0 8px rgba(56,189,248,0.5));
  animation: none !important;
}

/* === END SCREEN CHICKEN === */
.endScreenChickenWrap{
  width: 100px;
  height: 100px;
  margin: 0 auto 8px;
  display: block;
  overflow: visible;
  position: relative;
}
.endScreenChickenWrap img{
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}
.gameOverPopup .endScreenChickenWrap{
  animation: rageChickenEnd 0.4s ease-in-out infinite;
}
.gameOverPopup .endScreenChickenWrap img{
  filter: saturate(1.5) hue-rotate(-10deg);
}
.victoryPopup .endScreenChickenWrap{
  animation: victoryChickenEnd 1s ease-in-out infinite;
}
@keyframes rageChickenEnd{
  0%{ transform: rotate(-3deg) scale(1); }
  25%{ transform: rotate(3deg) scale(1.05); }
  50%{ transform: rotate(-2deg) scale(1.02); }
  75%{ transform: rotate(2deg) scale(1.04); }
  100%{ transform: rotate(-3deg) scale(1); }
}
@keyframes victoryChickenEnd{
  0%{ transform: translateY(0) rotate(0) scale(1); }
  20%{ transform: translateY(-12px) rotate(-5deg) scale(1.08); }
  40%{ transform: translateY(0) rotate(5deg) scale(1); }
  60%{ transform: translateY(-8px) rotate(-3deg) scale(1.05); }
  80%{ transform: translateY(0) rotate(2deg) scale(1); }
  100%{ transform: translateY(0) rotate(0) scale(1); }
}
```

  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="wink">

  <!-- CHICKEN PEEK (slides in from right) -->

  <div class="chickenPeek" id="chickenPeek">
    <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/5e8433c9-0f98-4b40-8646-dcec028601b8.png" alt="" 
      onload="this.parentElement.classList.add('loaded')" 
      onerror="this.parentElement.style.display='none'">
  </div>

  <!-- NAME ENTRY SCREEN -->

  <div class="nameEntryScreen" id="nameEntryScreen">
    <div class="nameEntryCard">
      <h2>üêî Hands Please! Quiz</h2>
      <p>Enter your name to join the competition!</p>
      <input type="text" id="playerNameInput" placeholder="Your name..." maxlength="30" />
      <button class="submitBtn" onclick="goToRules()">Next ‚Üí</button>
    </div>
  </div>

  <!-- RULES PAGE -->

  <div class="rulesScreen" id="rulesScreen">
    <div class="rulesCard">
      <h2>üìã How to Play</h2>
      <div class="rulesSection">
        <h3>‚ö° Scoring</h3>
        <div class="rulesGrid">
          <div class="ruleBox"><div class="ruleVal">100</div><div class="ruleLabel">Base Points</div></div>
          <div class="ruleBox"><div class="ruleVal">+50</div><div class="ruleLabel">Speed Bonus (‚â§5s)</div></div>
          <div class="ruleBox"><div class="ruleVal">2x</div><div class="ruleLabel">3-Streak Multiplier</div></div>
          <div class="ruleBox"><div class="ruleVal">3x</div><div class="ruleLabel">5-Streak Multiplier</div></div>
        </div>
      </div>
      <div class="rulesSection">
        <h3>ü•ö Lives</h3>
        <p style="font-size:13px; color:var(--ink-muted); line-height:1.5;">You have <strong style="color:var(--ink);">3 eggs</strong> (lives). Each wrong answer or timeout cracks one. Lose all 3 and it's game over!</p>
      </div>
      <div class="rulesSection">
        <h3>üéÆ Lifelines (1 use each)</h3>
        <div class="lifelineRow">
          <div class="lifelineBox"><div class="llIcon">üõ°Ô∏è</div><div class="llName">Shield</div><div class="llDesc">Skip question, no penalty</div></div>
          <div class="lifelineBox"><div class="llIcon">‚ö°</div><div class="llName">Spotlight</div><div class="llDesc">Eliminate 1 wrong answer</div></div>
          <div class="lifelineBox"><div class="llIcon">‚è≥</div><div class="llName">Time Freeze</div><div class="llDesc">Pause the timer</div></div>
        </div>
      </div>
      <div class="rulesSection">
        <h3>üèÜ Ranks</h3>
        <div class="ranksList">
          <div class="rankTag">üç≥ &lt;300 Still Learning</div>
          <div class="rankTag">ü•ö 300+ Getting There</div>
          <div class="rankTag">üêî 600+ Solid Server</div>
          <div class="rankTag">‚≠ê 900+ Breakfast Pro</div>
          <div class="rankTag">üèÜ 1200+ Legend</div>
        </div>
      </div>
      <button class="submitBtn" onclick="startQuizFromRules()" style="margin-top:8px;">Let's Go! üêî</button>
    </div>
  </div>

  <!-- MAIN QUIZ -->

  <div class="mainContainer" id="mainContainer" style="display: none;">

```
<div class="eggsHUD">
  <div class="egg" id="egg1"></div>
  <div class="egg" id="egg2"></div>
  <div class="egg" id="egg3"></div>
</div>

<div class="quizCard" id="quizCard">

  <!-- XP Progress Bar -->
  <div class="xpBarWrap">
    <span class="xpLabel" id="xpLabel">Q 1 / 9</span>
    <div class="xpBarFill" id="xpBarFill"></div>
  </div>

  <div class="quizHeader">
    <!-- Inline eggs for mobile -->
    <div class="eggsInline" id="eggsInline">
      <div class="egg" id="eggM1"></div>
      <div class="egg" id="eggM2"></div>
      <div class="egg" id="eggM3"></div>
    </div>
    <span id="streakBadge" class="streakBadge"></span>
    <span id="scoreDisplay">0 pts</span>
  </div>

  <!-- Timer -->
  <div class="timerWrap">
    <div class="timerBar" id="timerBar"></div>
    <span class="timerCount" id="timerCount">15s</span>
  </div>

  <div class="quizTitle">Hands Please!</div>
  <div class="playerName" id="playerNameDisplay"></div>

  <!-- Power-Ups -->
  <div class="powerUpsRow" id="powerUpsRow">
    <button class="powerUpBtn" id="shieldBtn" onclick="useShield()">üõ°Ô∏è<span class="puLabel"> Shield</span></button>
    <button class="powerUpBtn" id="spotlightBtn" onclick="useSpotlight()">‚ö°<span class="puLabel"> Spotlight</span></button>
    <button class="powerUpBtn" id="freezeBtn" onclick="useFreeze()">‚è≥<span class="puLabel"> Freeze</span></button>
  </div>

  <!-- Question Area (for slide transitions) -->
  <div class="questionArea" id="questionArea">
    <div class="questionText" id="questionText">Loading...</div>
    <div class="choices" id="choicesContainer"></div>
  </div>

  <button class="submitBtn" id="submitBtn">Submit Answer</button>

  <div class="feedback" id="feedbackText"></div>
</div>

<div class="chickenStage" id="chickenStage">
  <img class="chickenImage happy" id="happyImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/3e87e01e-4024-482b-a8ff-2413dc23cf56.png" alt="" onerror="this.style.display='none'">
  <img class="chickenImage angry" id="angryImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/2036a4c0-36eb-4538-bfd4-94ccb3f03b24.png" alt="" onerror="this.style.display='none'">
  <img class="chickenImage wink" id="winkImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/5e8433c9-0f98-4b40-8646-dcec028601b8.png" alt="" onerror="this.style.display='none'">
</div>
```

  </div>

  <!-- GAME OVER POPUP -->

  <div class="gameOverPopup" id="gameOverPopup">
    <div class="endScreenChickenWrap" id="gameOverChickenWrap"></div>
    <h2>Strike 3!</h2>
    <p>Oh oh! The chicken is NOT happy.</p>
    <div class="endRank" id="gameOverRank"></div>
    <div class="statsGrid" id="gameOverStats"></div>
    <p>Study hard and try again!</p>
    <button onclick="location.reload()">Try Again</button>
  </div>

  <!-- VICTORY POPUP -->

  <div class="victoryPopup" id="victoryPopup">
    <div class="endScreenChickenWrap" id="victoryChickenWrap"></div>
    <h2>üéâ Quiz Complete!</h2>
    <div class="finalScore" id="finalScore">0 pts</div>
    <div class="endRank" id="victoryRank"></div>
    <div class="statsGrid" id="victoryStats"></div>
    <p id="victoryMessage"></p>
    <button onclick="location.reload()">Play Again</button>
    <button onclick="openLeaderboard()" style="background: linear-gradient(135deg, var(--accent), #c9a030); color: var(--bg-deep);">View Leaderboard</button>
  </div>

  <!-- LEADERBOARD BUTTON -->

<button class="leaderboardBtn" onclick="openLeaderboard()">üèÜ Leaderboard</button>

  <!-- MUSIC TOGGLE -->

<button class="musicToggleBtn" id="musicToggle" onclick="toggleMusic()">üîä</button>

  <!-- LEADERBOARD MODAL -->

  <div class="leaderboardModal" id="leaderboardModal">
    <div class="leaderboardPanel">
      <div class="leaderboardHeader">
        <h2>üèÜ Leaderboard</h2>
        <button class="btnSecondary" style="background: rgba(255,255,255,0.15); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-family: inherit; font-weight: 700;" onclick="closeLeaderboard()">Close</button>
      </div>
      <div class="leaderboardBody">
        <div class="leaderboardList" id="leaderboardList"></div>
      </div>
    </div>
  </div>

  <!-- ADMIN LINK -->

<a href="#" class="adminLink" onclick="event.preventDefault(); openAdmin();">Admin</a>

  <!-- ADMIN MODAL -->

  <div class="adminModal" id="adminModal">
    <div class="adminPanel">
      <div class="adminHeader">
        <h2>Admin Panel</h2>
        <button class="btnSecondary" onclick="closeAdmin()">Close</button>
      </div>
      <div class="adminTabs">
        <div class="adminTab active" onclick="switchAdminTab('questions')">Questions</div>
        <div class="adminTab" onclick="switchAdminTab('leaderboard')">Manage Leaderboard</div>
      </div>
      <div class="adminBody">
        <div class="adminSection active" id="adminQuestionsTab">
          <div class="adminControls">
            <button class="btnPrimary" onclick="showAddForm()">‚ûï Add New Question</button>
            <button class="btnSecondary" onclick="resetToDefaults()">Reset to Defaults</button>
            <button class="btnSecondary" onclick="exportQuestions()">Export JSON</button>
            <button class="btnSecondary" onclick="importQuestions()">Import JSON</button>
          </div>
          <div class="editorForm" id="editorForm">
            <h3 style="margin-bottom:14px; color:var(--accent); font-weight:800;">Edit Question</h3>
            <div class="formField">
              <label>Question Text:</label>
              <textarea id="editQuestionText" placeholder="Enter your question..."></textarea>
            </div>
            <div class="formField">
              <label>Answer Choices (check the correct one):</label>
              <div class="choiceEditor" id="choiceEditor"></div>
              <button class="btnSecondary" onclick="addChoiceRow()" style="margin-top:8px; padding:6px 10px; font-size:12px;">+ Add Choice</button>
            </div>
            <div class="formActions">
              <button class="btnPrimary" onclick="saveQuestion()">Save Question</button>
              <button class="btnSecondary" onclick="cancelEdit()">Cancel</button>
              <button class="btnDanger" onclick="deleteCurrentQuestion()" id="deleteBtn" style="display:none;">Delete Question</button>
            </div>
          </div>
          <div class="questionsList" id="questionsList"></div>
        </div>
        <div class="adminSection" id="adminLeaderboardTab">
          <div class="adminControls">
            <button class="btnDanger" onclick="clearAllScores()">Clear All Scores</button>
          </div>
          <div class="leaderboardAdminList" id="leaderboardAdminList"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const ADMIN_PASSWORD = 'Iworkfortips';

    // === SUPABASE ===
    const SUPABASE_URL = "https://beyeqxromrqoiruejddp.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJleWVxeHJvbXJxb2lydWVqZGRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5MjcwMDEsImV4cCI6MjA4NTUwMzAwMX0.LIt8CG0DYeQDXE1RhvGPNyjVdK8SarSGuXJJJd2Ku7o";

    const { createClient } = supabase;
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const SB_LB_TABLE = "hp_quiz_leaderboard";
    const SB_Q_TABLE  = "hp_quiz_questions";
    const SB_Q_ID = "main";

    async function sbFetchLeaderboard(limit = 200){
      const { data, error } = await sb
        .from(SB_LB_TABLE)
        .select("id,name,score,total,created_at")
        .order("score", { ascending: false })
        .order("created_at", { ascending: true })
        .limit(limit);
      if(error) throw error;
      return (data || []).map(r => ({
        id: r.id, name: r.name, score: r.score, total: r.total, date: r.created_at
      }));
    }

    async function sbInsertScore(name, score, total){
      const { error } = await sb.from(SB_LB_TABLE).insert([{ name, score, total }]);
      if(error) throw error;
    }

    async function sbDeleteScoreById(id){
      const { error } = await sb.from(SB_LB_TABLE).delete().eq("id", id);
      if(error) throw error;
    }

    async function sbClearAllScores(){
      const { error } = await sb
        .from(SB_LB_TABLE)
        .delete()
        .neq("id", "00000000-0000-0000-0000-000000000000");
      if(error) throw error;
    }

    async function sbLoadQuestions(){
      const { data, error } = await sb
        .from(SB_Q_TABLE)
        .select("questions")
        .eq("id", SB_Q_ID)
        .maybeSingle();
      if(error) throw error;
      return data?.questions || null;
    }

    async function sbSaveQuestions(questionsArr){
      const { error } = await sb
        .from(SB_Q_TABLE)
        .upsert({ id: SB_Q_ID, questions: questionsArr }, { onConflict: "id" });
      if(error) throw error;
    }

    // === CHICKEN ANIMATION ===
    const CHICKEN_IMAGES = {
      happy: [
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/3e87e01e-4024-482b-a8ff-2413dc23cf56.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/5cf3e5fe-edb5-4d16-98b8-d45e90eef68e.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/b498ce6d-decf-4441-8f26-57074747b8f5.png'
      ],
      angry: [
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/2036a4c0-36eb-4538-bfd4-94ccb3f03b24.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/43f53595-f8e6-49ff-8bdf-7cfa8fb1e359.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/bd76b9ab-3a56-49bf-a5e8-6aa9d74a16dd.png'
      ],
      wink: [
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/5e8433c9-0f98-4b40-8646-dcec028601b8.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/37753db4-6856-47fe-9f66-f652f7506e99.png',
        'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/fa393d61-fd60-4e86-9889-d6e25461711f.png'
      ]
    };

    let currentFrame = 0;
    let animationInterval = null;

    function startChickenAnimation(mood) {
      stopChickenAnimation();
      const images = CHICKEN_IMAGES[mood];
      if (!images || images.length === 0) return;
      currentFrame = 0;
      updateChickenFrame(mood);
      animationInterval = setInterval(() => {
        currentFrame = (currentFrame + 1) % images.length;
        updateChickenFrame(mood);
      }, 200);
    }

    function updateChickenFrame(mood) {
      const img = document.querySelector(`.chickenImage.${mood}`);
      if (img) img.src = CHICKEN_IMAGES[mood][currentFrame];
    }

    function stopChickenAnimation() {
      if (animationInterval) { clearInterval(animationInterval); animationInterval = null; }
    }

    function setChickenMood(mood) {
      document.body.className = mood;
      if (chickenFirstEntry) {
        chickenFirstEntry = false;
        const stage = document.querySelector('.chickenStage');
        if (stage) {
          stage.classList.add('entering');
          stage.addEventListener('animationend', () => stage.classList.remove('entering'), { once: true });
        }
      }
      startChickenAnimation(mood);
      
      // On mobile: briefly show chicken peeking in for reactions
      const stage = document.querySelector('.chickenStage');
      const isMobile = !stage || getComputedStyle(stage).display === 'none';
      if (isMobile && (mood === 'happy' || mood === 'angry' || mood === 'rage' || mood === 'victory')) {
        showMobileChickenPeek(mood);
      }
    }

    // Mobile chicken peek-in for reactions
    let mobileChickenTimeout = null;
    function showMobileChickenPeek(mood) {
      const peek = document.getElementById('chickenPeek');
      if (!peek || !peek.classList.contains('loaded')) return;
      // Update peek image based on mood
      const img = peek.querySelector('img');
      if (mood === 'angry' || mood === 'rage') {
        img.src = CHICKEN_IMAGES.angry[0];
        if (mood === 'rage') img.style.filter = 'saturate(2) hue-rotate(-20deg) brightness(1.1)';
        else img.style.filter = '';
      } else {
        img.src = CHICKEN_IMAGES.happy[0];
        img.style.filter = '';
      }
      clearTimeout(mobileChickenTimeout);
      peek.classList.add('visible');
      const duration = mood === 'victory' ? 4000 : 1500;
      mobileChickenTimeout = setTimeout(() => peek.classList.remove('visible'), duration);
    }

    // === CHICKEN REACTION EMOJIS ===
    const REACTION_EMOJIS = {
      correct: ['‚ù§Ô∏è','‚ú®','üåü','üíõ','üôå'],
      wrong: ['üò§','üí¢','üò†','ü§¨','üí•'],
      streak: ['üî•','‚ö°','üíØ','üåà','‚ú®'],
      timeout: ['üò∞','üí¶','‚è∞','üòì','üò¨']
    };

    function spawnChickenEmoji(type) {
      const stage = document.querySelector('.chickenStage');
      const isMobile = !stage || getComputedStyle(stage).display === 'none';
      const target = isMobile ? document.getElementById('quizCard') : stage;
      if (!target) return;
      
      const emojis = REACTION_EMOJIS[type] || REACTION_EMOJIS.correct;
      const count = type === 'streak' ? 3 : 2;
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const el = document.createElement('div');
          el.className = 'chickenEmoji';
          el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          if (isMobile) {
            // Spawn from top area of card
            el.style.top = '5px';
            el.style.left = (15 + Math.random() * 70) + '%';
            el.style.fontSize = '24px';
          } else {
            el.style.top = (30 + Math.random() * 40) + '%';
            el.style.left = (20 + Math.random() * 60) + '%';
          }
          el.style.setProperty('--ex', (Math.random() * 60 - 30) + 'px');
          target.appendChild(el);
          setTimeout(() => el.remove(), 1300);
        }, i * 200);
      }
    }

    // === AUDIO ‚Äî CHIPTUNE BGM ENGINE ===
    let audioCtx = null;
    let masterGain = null;
    let bgmPlaying = false;
    let bgmMode = 'normal'; // 'normal' | 'powerup'
    let bgmTimers = [];
    let bgmLoopId = null;

    function ensureAudio() {
      if (!audioCtx) {
        try {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          masterGain = audioCtx.createGain();
          masterGain.gain.value = 0.18;
          masterGain.connect(audioCtx.destination);
        } catch(e) {}
      }
      if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    }

    // Low-level tone player for SFX (bypasses master for punch)
    function playTone(freq, duration, delay, type = 'sine', volume = 0.25) {
      if (!audioCtx) return;
      try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + delay);
        gain.gain.setValueAtTime(volume, audioCtx.currentTime + delay);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + delay + duration);
        osc.start(audioCtx.currentTime + delay);
        osc.stop(audioCtx.currentTime + delay + duration + 0.01);
      } catch(e) {}
    }

    // BGM note player ‚Äî routes through master gain for volume control
    function bgmNote(freq, duration, startTime, type = 'square', vol = 0.12) {
      if (!audioCtx || !masterGain) return;
      try {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.connect(g); g.connect(masterGain);
        osc.type = type;
        osc.frequency.setValueAtTime(freq, startTime);
        g.gain.setValueAtTime(vol, startTime);
        g.gain.setValueAtTime(vol * 0.8, startTime + duration * 0.7);
        g.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
        osc.start(startTime);
        osc.stop(startTime + duration + 0.01);
      } catch(e) {}
    }

    // ---- Normal BGM: Bouncy chiptune loop (retro platformer feel) ----
    function playNormalBGM() {
      if (!audioCtx) return;
      const t = audioCtx.currentTime + 0.05;
      const bpm = 140;
      const eighth = 60 / bpm / 2;

      // Melody ‚Äî bright bouncy 8-bit tune
      const melody = [
        523, 523, 0, 659, 0, 784, 659, 0,  // C5 C5 . E5 . G5 E5 .
        698, 659, 587, 523, 0, 587, 659, 0,  // F5 E5 D5 C5 . D5 E5 .
        784, 784, 0, 880, 0, 784, 659, 0,   // G5 G5 . A5 . G5 E5 .
        587, 523, 494, 523, 0, 0, 0, 0,     // D5 C5 B4 C5 . . . .
      ];

      // Bass line ‚Äî simple bouncy root notes
      const bass = [
        131, 0, 131, 0, 175, 0, 175, 0,   // C3 . C3 . F3 . F3 .
        131, 0, 131, 0, 196, 0, 196, 0,   // C3 . C3 . G3 . G3 .
        175, 0, 175, 0, 165, 0, 165, 0,   // F3 . F3 . E3 . E3 .
        196, 0, 131, 0, 131, 0, 0, 0,     // G3 . C3 . C3 . . .
      ];

      melody.forEach((freq, i) => {
        if (freq > 0) bgmNote(freq, eighth * 0.8, t + i * eighth, 'square', 0.09);
      });

      bass.forEach((freq, i) => {
        if (freq > 0) bgmNote(freq, eighth * 0.75, t + i * eighth, 'triangle', 0.14);
      });

      // Hi-hat rhythm
      for (let i = 0; i < 32; i++) {
        if (i % 2 === 0) {
          bgmNote(12000 + Math.random() * 2000, 0.03, t + i * eighth, 'square', 0.015);
        }
      }

      const loopLen = 32 * eighth * 1000;
      return loopLen;
    }

    // ---- Power-up BGM: Faster, higher energy, triumphant feel ----
    function playPowerUpBGM() {
      if (!audioCtx) return;
      const t = audioCtx.currentTime + 0.05;
      const bpm = 170;
      const eighth = 60 / bpm / 2;

      // Melody ‚Äî triumphant ascending runs
      const melody = [
        784, 880, 988, 1047, 0, 1175, 1047, 988,  // G5 A5 B5 C6 . D6 C6 B5
        880, 988, 1047, 1175, 0, 1319, 1175, 0,    // A5 B5 C6 D6 . E6 D6 .
        1047, 988, 880, 784, 880, 988, 1047, 0,     // C6 B5 A5 G5 A5 B5 C6 .
        1175, 1319, 1175, 1047, 988, 880, 784, 0,   // D6 E6 D6 C6 B5 A5 G5 .
      ];

      // Bass ‚Äî driving energy
      const bass = [
        196, 0, 262, 0, 220, 0, 262, 0,   // G3 . C4 . A3 . C4 .
        220, 0, 262, 0, 247, 0, 294, 0,   // A3 . C4 . B3 . D4 .
        262, 0, 220, 0, 196, 0, 220, 0,   // C4 . A3 . G3 . A3 .
        247, 0, 294, 0, 262, 0, 196, 0,   // B3 . D4 . C4 . G3 .
      ];

      // Harmony layer ‚Äî adds thickness
      const harmony = [
        659, 0, 0, 784, 0, 0, 784, 0,
        698, 0, 0, 784, 0, 0, 880, 0,
        784, 0, 0, 659, 0, 0, 784, 0,
        880, 0, 0, 784, 0, 0, 659, 0,
      ];

      melody.forEach((freq, i) => {
        if (freq > 0) bgmNote(freq, eighth * 0.7, t + i * eighth, 'square', 0.08);
      });

      bass.forEach((freq, i) => {
        if (freq > 0) bgmNote(freq, eighth * 0.7, t + i * eighth, 'triangle', 0.13);
      });

      harmony.forEach((freq, i) => {
        if (freq > 0) bgmNote(freq, eighth * 0.6, t + i * eighth, 'sawtooth', 0.03);
      });

      // Faster hi-hat
      for (let i = 0; i < 32; i++) {
        bgmNote(13000 + Math.random() * 3000, 0.025, t + i * eighth, 'square', 0.018);
      }

      const loopLen = 32 * eighth * 1000;
      return loopLen;
    }

    function startBGM(mode = 'normal') {
      ensureAudio();
      if (!audioCtx) return;
      stopBGM();
      bgmPlaying = true;
      bgmMode = mode;

      function loop() {
        if (!bgmPlaying) return;
        const len = bgmMode === 'powerup' ? playPowerUpBGM() : playNormalBGM();
        bgmLoopId = setTimeout(loop, len - 50); // slight overlap for seamless loop
      }
      loop();
    }

    function stopBGM() {
      bgmPlaying = false;
      if (bgmLoopId) { clearTimeout(bgmLoopId); bgmLoopId = null; }
    }

    function switchBGM(mode) {
      if (bgmMode === mode && bgmPlaying) return;
      bgmMode = mode;
      if (bgmPlaying) {
        stopBGM();
        startBGM(mode);
      }
    }

    let musicMuted = false;

    function toggleMusic() {
      const btn = document.getElementById('musicToggle');
      if (musicMuted) {
        musicMuted = false;
        if (masterGain) masterGain.gain.value = 0.18;
        btn.textContent = 'üîä';
        if (!bgmPlaying && !gameOver) startBGM(bgmMode);
      } else {
        musicMuted = true;
        if (masterGain) masterGain.gain.value = 0;
        btn.textContent = 'üîá';
      }
    }

    // SFX ‚Äî kept as one-shot sounds
    function playSound(type) {
      ensureAudio();
      if (!audioCtx) return;
      if (type === 'correct') {
        playTone(523, 0.12, 0); playTone(659, 0.12, 0.1); playTone(784, 0.18, 0.2);
      } else if (type === 'wrong') {
        playTone(311, 0.1, 0, 'sawtooth', 0.2); playTone(233, 0.18, 0.12, 'sawtooth', 0.2);
      } else if (type === 'streak') {
        playTone(523, 0.08, 0); playTone(659, 0.08, 0.08); playTone(784, 0.08, 0.16); playTone(1047, 0.22, 0.24);
      } else if (type === 'timeout') {
        playTone(440, 0.08, 0, 'square', 0.2); playTone(349, 0.08, 0.09, 'square', 0.2); playTone(294, 0.18, 0.18, 'square', 0.2);
      } else if (type === 'gameover') {
        playTone(494, 0.15, 0, 'square', 0.3);
        playTone(440, 0.15, 0.18, 'square', 0.3);
        playTone(392, 0.15, 0.36, 'square', 0.3);
        playTone(330, 0.4, 0.54, 'square', 0.3);
      } else if (type === 'victory') {
        playTone(523, 0.1, 0, 'square', 0.25);
        playTone(659, 0.1, 0.1, 'square', 0.25);
        playTone(784, 0.1, 0.2, 'square', 0.25);
        playTone(1047, 0.15, 0.3, 'square', 0.25);
        playTone(988, 0.1, 0.48, 'square', 0.25);
        playTone(1047, 0.3, 0.6, 'square', 0.3);
      }
    }

    // === TIMER ===
    const QUESTION_TIME = 15;
    let timerInterval = null;
    let timeLeft = QUESTION_TIME;

    function startTimer() {
      stopTimer();
      timeLeft = QUESTION_TIME;
      timerFrozen = false;
      const bar = document.getElementById('timerBar');
      if (bar) bar.classList.remove('frozen');
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        if (timerFrozen) return; // Skip countdown when frozen
        timeLeft = Math.max(0, timeLeft - 0.1);
        updateTimerDisplay();
        if (timeLeft <= 0) { stopTimer(); handleTimerExpired(); }
      }, 100);
    }

    function stopTimer() {
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
    }

    function updateTimerDisplay() {
      const bar = document.getElementById('timerBar');
      const count = document.getElementById('timerCount');
      if (!bar) return;
      const pct = (timeLeft / QUESTION_TIME) * 100;
      bar.style.width = pct + '%';
      if (timeLeft > 10) {
        bar.style.backgroundColor = '#22c55e';
        if (count) count.style.color = 'var(--ink-muted)';
      } else if (timeLeft > 5) {
        bar.style.backgroundColor = '#f59e0b';
        if (count) count.style.color = '#f59e0b';
      } else {
        bar.style.backgroundColor = '#ef4444';
        if (count) count.style.color = '#ef4444';
      }
      if (count) count.textContent = Math.ceil(timeLeft) + 's';
      const card = document.getElementById('quizCard');
      if (timeLeft <= 5 && timeLeft > 0) {
        bar.classList.add('heartbeat', 'danger-glow');
        if (card) card.classList.add('urgency');
      } else {
        bar.classList.remove('heartbeat', 'danger-glow');
        if (card) card.classList.remove('urgency');
      }
    }

    function handleTimerExpired() {
      if (gameOver || questionAnswered) return;
      questionAnswered = true;

      const q = questions[currentIdx];
      strikes++;
      streak = 0;

      // Streak broken ‚Äî back to normal music
      switchBGM('normal');

      const _fb = document.getElementById('feedbackText');
      _fb.className = 'feedback reveal';
      _fb.innerText = `‚è∞ Time's up! Correct: ${q.c[q.a]}`;
      _fb.style.color = 'var(--danger)';

      highlightAnswers(-1, q.a);
      updateStreakDisplay();
      playSound('timeout');
      setChickenMood('angry');
      spawnChickenEmoji('timeout');

      // Screen shake
      triggerScreenShake();

      if (strikes <= 3) shatterEgg(document.getElementById('egg' + strikes));

      document.getElementById('submitBtn').disabled = true;
      disablePowerUps();

      if (strikes >= 3) {
        gameOver = true;
        setChickenMood('rage');
        setTimeout(() => finishQuiz(false), 1500);
      } else {
        setTimeout(() => { currentIdx++; transitionToNextQuestion(); setChickenMood('wink'); }, 2000);
      }
    }

    // === STREAK & POINTS ===
    let bestStreak = 0;
    let fastestAnswer = Infinity;
    let wrongCount = 0;

    function updateStreakDisplay() {
      const badge = document.getElementById('streakBadge');
      if (!badge) return;
      if (streak >= 5) {
        badge.style.display = 'inline-block';
        badge.textContent = 'üî•üî• 3x';
        badge.className = 'streakBadge hot';
      } else if (streak >= 3) {
        badge.style.display = 'inline-block';
        badge.textContent = 'üî• 2x';
        badge.className = 'streakBadge';
      } else if (streak >= 2) {
        badge.style.display = 'inline-block';
        badge.textContent = `üî• ${streak} streak`;
        badge.className = 'streakBadge';
      } else {
        badge.style.display = 'none';
        badge.className = 'streakBadge';
      }
      if (streak > bestStreak) bestStreak = streak;
    }

    function calculatePoints() {
      const elapsed = (Date.now() - questionStartTime) / 1000;
      if (elapsed < fastestAnswer) fastestAnswer = elapsed;
      const base = 100;
      let speedBonus = 0;
      if (elapsed <= 5) speedBonus = 50;
      else if (elapsed <= 10) speedBonus = 25;
      let multiplier = 1;
      if (streak >= 5) multiplier = 3;
      else if (streak >= 3) multiplier = 2;
      return { base, speedBonus, multiplier, total: (base + speedBonus) * multiplier };
    }

    function showScorePopup(pts) {
      const popup = document.createElement('div');
      popup.className = 'scorePopup';
      let html = `+${pts.total} pts`;
      const extras = [];
      if (pts.speedBonus > 0) extras.push(`‚ö° +${pts.speedBonus} speed`);
      if (pts.multiplier > 1) extras.push(`üî• ${pts.multiplier}x streak`);
      if (extras.length) html += `<br><small style="font-size:12px; opacity:0.9;">${extras.join('  ')}</small>`;
      popup.innerHTML = html;
      document.getElementById('quizCard').appendChild(popup);
      setTimeout(() => popup.remove(), 1400);
    }

    // === 2. CONFETTI BURST (mini burst from score area) ===
    function launchMiniConfetti(count = 12) {
      const card = document.getElementById('quizCard');
      if (!card) return;
      const colors = ['#f5d76e','#22c55e','#3b82f6','#ef4444','#a855f7','#f97316'];
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'miniConfetti';
        p.style.background = colors[Math.floor(Math.random() * colors.length)];
        p.style.right = '30px';
        p.style.top = '50px';
        const angle = Math.random() * Math.PI * 2;
        const dist = 40 + Math.random() * 80;
        p.style.setProperty('--tx', (Math.cos(angle) * dist) + 'px');
        p.style.setProperty('--ty', (Math.sin(angle) * dist) + 'px');
        card.appendChild(p);
        setTimeout(() => p.remove(), 900);
      }
    }

    function launchStreakConfetti(count = 24) {
      const card = document.getElementById('quizCard');
      if (!card) return;
      const colors = ['#f5d76e','#f97316','#ef4444','#22c55e','#a855f7','#3b82f6'];
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const p = document.createElement('div');
          p.className = 'miniConfetti';
          p.style.background = colors[Math.floor(Math.random() * colors.length)];
          p.style.left = (Math.random() * 100) + '%';
          p.style.top = '50%';
          p.style.width = '6px';
          p.style.height = '6px';
          const angle = Math.random() * Math.PI * 2;
          const dist = 60 + Math.random() * 120;
          p.style.setProperty('--tx', (Math.cos(angle) * dist) + 'px');
          p.style.setProperty('--ty', (Math.sin(angle) * dist) + 'px');
          card.appendChild(p);
          setTimeout(() => p.remove(), 900);
        }, Math.random() * 300);
      }
    }

    // === 3. SCREEN SHAKE ===
    function triggerScreenShake() {
      const card = document.getElementById('quizCard');
      if (!card) return;
      card.classList.remove('screen-shake');
      void card.offsetWidth;
      card.classList.add('screen-shake');
      card.addEventListener('animationend', () => card.classList.remove('screen-shake'), { once: true });
    }

    // === 4. POWER-UPS ===
    let shieldUsed = false;
    let spotlightUsed = false;
    let freezeUsed = false;
    let timerFrozen = false;

    function resetPowerUps() {
      shieldUsed = false;
      spotlightUsed = false;
      freezeUsed = false;
      timerFrozen = false;
      const shieldBtn = document.getElementById('shieldBtn');
      const spotlightBtn = document.getElementById('spotlightBtn');
      const freezeBtn = document.getElementById('freezeBtn');
      if (shieldBtn) { shieldBtn.disabled = false; shieldBtn.classList.remove('used'); }
      if (spotlightBtn) { spotlightBtn.disabled = false; spotlightBtn.classList.remove('used'); }
      if (freezeBtn) { freezeBtn.disabled = false; freezeBtn.classList.remove('used'); }
    }

    function disablePowerUps() {
      document.getElementById('shieldBtn').disabled = true;
      document.getElementById('spotlightBtn').disabled = true;
      document.getElementById('freezeBtn').disabled = true;
    }

    function enablePowerUps() {
      const shieldBtn = document.getElementById('shieldBtn');
      const spotlightBtn = document.getElementById('spotlightBtn');
      const freezeBtn = document.getElementById('freezeBtn');
      if (!shieldUsed) shieldBtn.disabled = false;
      if (!spotlightUsed) spotlightBtn.disabled = false;
      if (!freezeUsed) freezeBtn.disabled = false;
    }

    function useShield() {
      if (shieldUsed || gameOver || questionAnswered) return;
      shieldUsed = true;
      questionAnswered = true;
      stopTimer();

      const btn = document.getElementById('shieldBtn');
      btn.disabled = true;
      btn.classList.add('used');

      const fb = document.getElementById('feedbackText');
      fb.className = 'feedback reveal';
      fb.innerText = 'üõ°Ô∏è Shield activated! Skipping question...';
      fb.style.color = 'var(--accent)';

      disablePowerUps();
      document.getElementById('submitBtn').disabled = true;

      setTimeout(() => { currentIdx++; transitionToNextQuestion(); }, 1200);
    }

    function useSpotlight() {
      if (spotlightUsed || gameOver || questionAnswered) return;
      spotlightUsed = true;

      const btn = document.getElementById('spotlightBtn');
      btn.disabled = true;
      btn.classList.add('used');

      const q = questions[currentIdx];
      const choices = document.querySelectorAll('.choice');
      const wrongIndices = [];
      choices.forEach((c, i) => { if (i !== q.a) wrongIndices.push(i); });

      // Eliminate one random wrong answer
      if (wrongIndices.length > 0) {
        const removeIdx = wrongIndices[Math.floor(Math.random() * wrongIndices.length)];
        choices[removeIdx].classList.add('eliminated');
        const radio = choices[removeIdx].querySelector('input');
        if (radio) { radio.disabled = true; radio.checked = false; }
      }

      const fb = document.getElementById('feedbackText');
      fb.className = 'feedback reveal';
      fb.innerText = '‚ö° One wrong answer eliminated!';
      fb.style.color = 'var(--accent)';
      setTimeout(() => { if (!questionAnswered) { fb.innerText = ''; fb.className = 'feedback'; } }, 1500);
    }

    function useFreeze() {
      if (freezeUsed || gameOver || questionAnswered) return;
      freezeUsed = true;
      timerFrozen = true;

      const btn = document.getElementById('freezeBtn');
      btn.disabled = true;
      btn.classList.add('used');

      // Visual: freeze the timer bar
      const bar = document.getElementById('timerBar');
      if (bar) {
        bar.classList.remove('heartbeat', 'danger-glow');
        bar.classList.add('frozen');
      }
      const card = document.getElementById('quizCard');
      if (card) card.classList.remove('urgency');

      const fb = document.getElementById('feedbackText');
      fb.className = 'feedback reveal';
      fb.innerText = '‚è≥ Timer frozen! Take your time...';
      fb.style.color = '#38bdf8';
      setTimeout(() => { if (!questionAnswered) { fb.innerText = ''; fb.className = 'feedback'; } }, 2000);
    }

    // === 5. RANK / TITLE ===
    function getRank(points) {
      if (points >= 1200) return 'Breakfast Legend üèÜ';
      if (points >= 900)  return 'Breakfast Pro ‚≠ê';
      if (points >= 600)  return 'Solid Server üêî';
      if (points >= 300)  return 'Getting There ü•ö';
      return 'Still Learning üç≥';
    }

    // === 7. STATS SUMMARY ===
    function buildStatsHTML() {
      const fastest = fastestAnswer === Infinity ? '‚Äî' : fastestAnswer.toFixed(1) + 's';
      return `
        <div class="statBox"><div class="statVal">${score}</div><div class="statLabel">Correct</div></div>
        <div class="statBox"><div class="statVal">${wrongCount}</div><div class="statLabel">Wrong</div></div>
        <div class="statBox"><div class="statVal">${bestStreak}x</div><div class="statLabel">Best Streak</div></div>
        <div class="statBox"><div class="statVal">${fastest}</div><div class="statLabel">Fastest</div></div>
      `;
    }

    // === 9. STREAK MILESTONE BANNER ===
    function showStreakBanner(streakLevel) {
      const card = document.getElementById('quizCard');
      if (!card) return;
      const banner = document.createElement('div');
      if (streakLevel >= 5) {
        banner.className = 'streakBanner fire5';
        banner.textContent = 'üî•üî• UNSTOPPABLE! 3x Multiplier!';
      } else {
        banner.className = 'streakBanner fire3';
        banner.textContent = 'üî• ON FIRE! 2x Multiplier!';
      }
      card.appendChild(banner);
      setTimeout(() => banner.remove(), 2000);
    }

    // === 10. SMOOTH QUESTION TRANSITIONS ===
    function transitionToNextQuestion() {
      const area = document.getElementById('questionArea');
      if (!area) { renderQuestion(); return; }
      area.classList.remove('slide-in');
      area.classList.add('slide-out');
      setTimeout(() => {
        renderQuestion();
        area.classList.remove('slide-out');
        area.classList.add('slide-in');
        area.addEventListener('animationend', () => area.classList.remove('slide-in'), { once: true });
      }, 250);
    }

    // === ANSWER HIGHLIGHT ===
    function highlightAnswers(selectedIdx, correctIdx) {
      document.querySelectorAll('.choice').forEach((label, i) => {
        label.style.pointerEvents = 'none';
        const radio = label.querySelector('input[type="radio"]');
        if (radio) radio.disabled = true;
        if (label.classList.contains('eliminated')) return;
        if (i === correctIdx) {
          label.classList.add('correct-highlight');
          setTimeout(() => label.classList.add('glow-pulse'), 30);
        } else if (i === selectedIdx) {
          label.classList.add('wrong-highlight');
        } else {
          label.classList.add('dimmed');
        }
      });
    }

    // === GAME STATE ===
    const DEFAULT_BANK = [
      { id: '1', q: "Describe Loop juices to a guest:", c: ["Imperfect produce, cold pressed, circular economy", "Fresh squeezed daily in-house", "Concentrate from cartons"], a: 0 },
      { id: '2', q: "Is the Farmhouse Breakfast gluten free?", c: ["Yes, it's naturally gluten free", "No - potatoes cooked in shared fryer (cross-contamination)", "Only if you remove the eggs"], a: 1 },
      { id: '3', q: "What can VEGAN guests eat?", c: ["Farmhouse Breakfast (no eggs)", "Vegan Mexican Scramble or Fruit Plate", "Eggs Benedict (hold hollandaise)"], a: 1 },
      { id: '4', q: "What's in the Power Bowl?", c: ["Oatmeal with brown sugar", "Greek yogurt, berries, granola, smoothie, fresh fruit", "Acai blend with granola"], a: 1 },
      { id: '5', q: "Components of Avocado Toast:", c: ["Sourdough, smashed avo, poached eggs, radish, pickled onion, feta", "Rye bread, fried egg, bacon", "Gluten free toast, plain avocado"], a: 0 },
      { id: '6', q: "Is the Oatmeal gluten free?", c: ["Yes, certified gluten free", "Cooked in water but NOT celiac-safe (trace risk)", "Only if ordered plain"], a: 1 },
      { id: '7', q: "Belgian Waffle comes with:", c: ["Just butter and syrup", "Fresh berries, maple whipped cream, salted caramel, icing sugar", "Chocolate sauce and banana"], a: 1 },
      { id: '8', q: "Dairy-free options:", c: ["Pancakes with butter", "Fruit Plate, Vegan Scramble, Oatmeal (water-cooked)", "Yogurt Bowl"], a: 1 },
      { id: '9', q: "Can Celiac guests have potatoes/fries?", c: ["Yes, totally safe", "No - cooked in shared fryer with gluten items", "Only baked potatoes"], a: 1 }
    ];

    let questions = [];
    let currentIdx = 0;
    let score = 0;
    let totalPoints = 0;
    let streak = 0;
    let strikes = 0;
    let gameOver = false;
    let questionAnswered = false;
    let questionStartTime = 0;
    let editingId = null;
    let playerName = '';
    let chickenFirstEntry = true;

    // === NAME ENTRY ‚Üí RULES ‚Üí START ===
    function goToRules() {
      const input = document.getElementById('playerNameInput');
      const name = input.value.trim();
      if (!name) { alert('Please enter your name!'); return; }
      ensureAudio();
      playerName = name;
      document.getElementById('nameEntryScreen').style.display = 'none';
      document.getElementById('chickenPeek').classList.remove('visible');
      document.getElementById('rulesScreen').style.display = 'flex';
    }

    async function startQuizFromRules() {
      document.getElementById('playerNameDisplay').innerText = `Player: ${playerName}`;
      document.getElementById('rulesScreen').style.display = 'none';
      document.getElementById('mainContainer').style.display = 'flex';
      await init();
    }

    // Legacy compat
    async function startQuiz() { goToRules(); }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('playerNameInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') goToRules();
      });
      // Chicken peek animation on name entry
      setTimeout(() => {
        const peek = document.getElementById('chickenPeek');
        if (peek) peek.classList.add('visible');
      }, 1200);
    });

    // === INIT ===
    async function init() {
      try {
        const remote = await sbLoadQuestions();
        if (Array.isArray(remote) && remote.length) questions = remote;
        else {
          const stored = localStorage.getItem('handsPlease_quiz_v5');
          questions = stored ? JSON.parse(stored) : [...DEFAULT_BANK];
        }
      } catch(err) {
        const stored = localStorage.getItem('handsPlease_quiz_v5');
        questions = stored ? JSON.parse(stored) : [...DEFAULT_BANK];
      }

      questions.forEach((q, i) => { if (!q.id) q.id = 'q' + Date.now() + i; });
      questions.sort(() => Math.random() - 0.5);

      currentIdx = 0; score = 0; totalPoints = 0; streak = 0; strikes = 0;
      gameOver = false; questionAnswered = false;
      bestStreak = 0; fastestAnswer = Infinity; wrongCount = 0;

      chickenFirstEntry = true;
      setChickenMood('wink');
      resetPowerUps();
      document.getElementById('gameOverPopup').style.display = 'none';
      document.getElementById('victoryPopup').style.display = 'none';
      document.querySelectorAll('.egg').forEach(e => {
        e.className = 'egg alive-pulse';
        // Remove any crack remnants
        e.querySelectorAll('.eggHalf, .eggYolk, .eggWhite, .eggDrip, canvas').forEach(c => c.remove());
      });
      document.getElementById('scoreDisplay').innerText = '0 pts';
      updateStreakDisplay();
      renderQuestion();
      startBGM('normal');
    }

    // === 6. XP PROGRESS BAR UPDATE ===
    function updateXPBar() {
      const fill = document.getElementById('xpBarFill');
      const label = document.getElementById('xpLabel');
      if (!fill) return;
      const pct = ((currentIdx) / questions.length) * 100;
      fill.style.width = pct + '%';
      if (label) label.textContent = `Q ${currentIdx + 1} / ${questions.length}`;
    }

    // === RENDER QUESTION ===
    function renderQuestion() {
      if (currentIdx >= questions.length) { finishQuiz(true); return; }

      questionAnswered = false;
      questionStartTime = Date.now();

      const _timerBar = document.getElementById('timerBar');
      if (_timerBar) _timerBar.classList.remove('heartbeat', 'danger-glow');
      const _card = document.getElementById('quizCard');
      if (_card) _card.classList.remove('urgency');

      const q = questions[currentIdx];

      // XP bar
      updateXPBar();

      document.getElementById('scoreDisplay').innerText = `${totalPoints} pts`;

      const questionTextEl = document.getElementById('questionText');
      questionTextEl.innerText = q.q;

      const feedbackEl = document.getElementById('feedbackText');
      feedbackEl.innerText = '';
      feedbackEl.className = 'feedback';

      const container = document.getElementById('choicesContainer');
      container.innerHTML = '';

      q.c.forEach((choice, i) => {
        const label = document.createElement('label');
        label.className = 'choice stagger-in';
        label.style.animationDelay = (i * 55) + 'ms';
        label.innerHTML = `<input type="radio" name="answer" value="${i}"> ${choice}`;
        container.appendChild(label);
      });

      document.getElementById('submitBtn').disabled = false;
      enablePowerUps();
      startTimer();
    }

    // === SUBMIT ===
    document.getElementById('submitBtn').addEventListener('click', (e) => {
      // Ripple
      const _btn = e.currentTarget;
      const _rect = _btn.getBoundingClientRect();
      const _r = document.createElement('span');
      _r.className = 'ripple';
      _r.style.left = (e.clientX - _rect.left - 5) + 'px';
      _r.style.top  = (e.clientY - _rect.top  - 5) + 'px';
      _btn.appendChild(_r);
      setTimeout(() => _r.remove(), 700);

      if (gameOver || questionAnswered) return;

      const selected = document.querySelector('input[name="answer"]:checked');
      if (!selected) {
        document.getElementById('feedbackText').innerText = '‚ö†Ô∏è Please select an answer';
        return;
      }

      questionAnswered = true;
      stopTimer();
      disablePowerUps();

      const answer = parseInt(selected.value);
      const q = questions[currentIdx];
      const correct = (answer === q.a);

      highlightAnswers(answer, q.a);
      document.getElementById('submitBtn').disabled = true;

      if (correct) {
        score++;
        streak++;
        const pts = calculatePoints();
        const prevPoints = totalPoints;
        totalPoints += pts.total;

        const fbEl = document.getElementById('feedbackText');
        fbEl.className = 'feedback reveal';
        fbEl.innerText = '‚úÖ Correct!';
        fbEl.style.color = 'var(--ok)';

        animateScore(prevPoints, totalPoints);
        const scoreEl = document.getElementById('scoreDisplay');
        scoreEl.classList.remove('pop'); void scoreEl.offsetWidth; scoreEl.classList.add('pop');

        showScorePopup(pts);
        launchMiniConfetti(10);
        updateStreakDisplay();
        setChickenMood('happy');
        spawnChickenEmoji(streak >= 3 ? 'streak' : 'correct');

        // Switch to power-up music when streak hits 2+
        if (streak >= 2) switchBGM('powerup');

        if (streak === 3 || streak === 5) {
          playSound('streak');
          showStreakBanner(streak);
          launchStreakConfetti(30);
        } else {
          playSound('correct');
        }

        setTimeout(() => { currentIdx++; transitionToNextQuestion(); setChickenMood('wink'); }, 1500);

      } else {
        strikes++;
        wrongCount++;
        streak = 0;

        // Streak broken ‚Äî back to normal music
        switchBGM('normal');

        const fbEl2 = document.getElementById('feedbackText');
        fbEl2.className = 'feedback reveal';
        fbEl2.innerText = `‚ùå Wrong! Correct: ${q.c[q.a]}`;
        fbEl2.style.color = 'var(--danger)';

        if (strikes <= 3) shatterEgg(document.getElementById('egg' + strikes));

        triggerScreenShake();
        updateStreakDisplay();
        setChickenMood('angry');
        spawnChickenEmoji('wrong');
        playSound('wrong');

        if (strikes >= 3) {
          gameOver = true;
          setChickenMood('rage');
          setTimeout(() => finishQuiz(false), 1200);
        } else {
          setTimeout(() => { currentIdx++; transitionToNextQuestion(); setChickenMood('wink'); }, 2000);
        }
      }
    });

    // === FINISH ===
    function injectEndScreenChicken(wrapperId, mood) {
      const wrap = document.getElementById(wrapperId);
      if (!wrap) return;
      wrap.innerHTML = ''; // clear previous
      const srcImg = mood === 'angry' ? document.getElementById('angryImg') : document.getElementById('happyImg');
      if (!srcImg || !srcImg.naturalWidth) {
        // Image didn't load ‚Äî try using the URL from CHICKEN_IMAGES
        const url = mood === 'angry' ? CHICKEN_IMAGES.angry[0] : CHICKEN_IMAGES.happy[0];
        const img = document.createElement('img');
        img.src = url;
        img.alt = '';
        img.onerror = () => { wrap.style.display = 'none'; };
        wrap.appendChild(img);
      } else {
        // Clone the already-loaded image
        const clone = srcImg.cloneNode(true);
        clone.className = '';
        clone.style.display = 'block';
        clone.removeAttribute('id');
        wrap.appendChild(clone);
      }
    }

    function finishQuiz(completed) {
      stopTimer();
      stopBGM();
      const maxPoints = questions.length * 100;
      const rank = getRank(totalPoints);

      if (strikes >= 3) {
        playSound('gameover');
        injectEndScreenChicken('gameOverChickenWrap', 'angry');
        document.getElementById('gameOverRank').innerText = rank;
        document.getElementById('gameOverStats').innerHTML = buildStatsHTML();
        const goPopup = document.getElementById('gameOverPopup');
        goPopup.style.display = 'block';
        goPopup.classList.remove('entering'); void goPopup.offsetWidth;
        goPopup.classList.add('entering');
        setChickenMood('peck');
        saveScore(totalPoints, maxPoints);
      } else if (completed) {
        showVictory(rank);
        setChickenMood('victory');
        saveScore(totalPoints, maxPoints);
      }
    }

    // === LEADERBOARD ===
    async function saveScore(score, total) {
      try { await sbInsertScore(playerName, score, total); } catch(err) {
        const leaderboard = getLeaderboard();
        leaderboard.push({ name: playerName, score, total, date: new Date().toISOString() });
        leaderboard.sort((a, b) => b.score - a.score);
        localStorage.setItem('handsPlease_leaderboard', JSON.stringify(leaderboard));
      }
    }

    function getLeaderboard() {
      const stored = localStorage.getItem('handsPlease_leaderboard');
      return stored ? JSON.parse(stored) : [];
    }

    async function openLeaderboard() {
      document.getElementById('leaderboardModal').style.display = 'flex';
      await renderLeaderboard();
    }

    function closeLeaderboard() {
      document.getElementById('leaderboardModal').style.display = 'none';
    }

    // === 8. LEADERBOARD WITH MEDALS ===
    async function renderLeaderboard() {
      const list = document.getElementById('leaderboardList');
      list.innerHTML = '<div class="emptyLeaderboard"><p>Loading...</p></div>';

      let leaderboard = [];
      try { leaderboard = await sbFetchLeaderboard(50); } catch(err) { leaderboard = getLeaderboard(); }

      if (!leaderboard || leaderboard.length === 0) {
        list.innerHTML = '<div class="emptyLeaderboard"><p>No scores yet!</p><p>Be the first to complete the quiz!</p></div>';
        return;
      }

      const medals = ['ü•á', 'ü•à', 'ü•â'];
      const medalClasses = ['medal-gold', 'medal-silver', 'medal-bronze'];

      list.innerHTML = '';
      leaderboard.forEach((entry, index) => {
        const item = document.createElement('div');
        item.className = 'leaderboardItem';
        if (index === 0) item.classList.add('champion');
        if (index < 3) item.classList.add(medalClasses[index]);

        const date = new Date(entry.date);
        const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

        const rankDisplay = index < 3 ? medals[index] : (index + 1);

        item.innerHTML = `
          <div class="leaderboardRank">${rankDisplay}</div>
          <div class="leaderboardInfo">
            <div class="leaderboardName">${entry.name}</div>
            <div class="leaderboardDate">${dateStr}</div>
          </div>
          <div class="leaderboardScore">${entry.score} pts</div>
        `;
        list.appendChild(item);
      });
    }

    // === ADMIN ===
    function openAdmin() {
      const password = prompt('Enter admin password:');
      if (password !== ADMIN_PASSWORD) { alert('Incorrect password!'); return; }
      document.getElementById('adminModal').style.display = 'flex';
      switchAdminTab('questions');
      refreshQuestionsList();
      renderLeaderboardAdmin();
    }

    function closeAdmin() {
      document.getElementById('adminModal').style.display = 'none';
      cancelEdit();
    }

    function switchAdminTab(tab) {
      document.querySelectorAll('.adminTab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.adminSection').forEach(s => s.classList.remove('active'));
      event.target.classList.add('active');
      if (tab === 'questions') {
        document.getElementById('adminQuestionsTab').classList.add('active');
        refreshQuestionsList();
      } else if (tab === 'leaderboard') {
        document.getElementById('adminLeaderboardTab').classList.add('active');
        renderLeaderboardAdmin();
      }
    }

    async function renderLeaderboardAdmin() {
      const list = document.getElementById('leaderboardAdminList');
      list.innerHTML = '<div class="emptyLeaderboard"><p>Loading...</p></div>';
      let leaderboard = [];
      try { leaderboard = await sbFetchLeaderboard(200); } catch(err) { leaderboard = getLeaderboard(); }
      if (!leaderboard || leaderboard.length === 0) {
        list.innerHTML = '<div class="emptyLeaderboard"><p>No scores yet</p></div>';
        return;
      }
      list.innerHTML = '';
      leaderboard.forEach((entry, index) => {
        const item = document.createElement('div');
        item.className = 'leaderboardAdminItem';
        if (index === 0) item.classList.add('champion');
        const date = new Date(entry.date);
        const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        item.innerHTML = `
          <div class="leaderboardAdminInfo">
            <div class="leaderboardAdminName">${index === 0 ? 'üëë ' : ''}${entry.name}</div>
            <div class="leaderboardAdminDate">${dateStr}</div>
          </div>
          <div class="leaderboardAdminScore">${entry.score} pts</div>
          <button class="btnDanger" style="padding:6px 10px; font-size:12px;" onclick="deleteScoreById('${entry.id}')">Delete</button>
        `;
        list.appendChild(item);
      });
    }

    async function deleteScoreById(id) {
      if (!confirm('Delete this score?')) return;
      try { await sbDeleteScoreById(id); await renderLeaderboardAdmin(); } catch(err) { alert("Delete failed."); }
    }

    async function clearAllScores() {
      if (!confirm('Clear ALL scores? This cannot be undone!')) return;
      try { await sbClearAllScores(); await renderLeaderboardAdmin(); } catch(err) { alert("Clear all failed."); }
    }

    function refreshQuestionsList() {
      const list = document.getElementById('questionsList');
      list.innerHTML = '';
      questions.forEach((q, idx) => {
        const card = document.createElement('div');
        card.className = 'qCard';
        const choicesHTML = q.c.map((c, i) =>
          `<div class="${i === q.a ? 'correct' : ''}">${i === q.a ? '‚úì' : '‚óã'} ${c}</div>`
        ).join('');
        card.innerHTML = `
          <div class="qText">${idx + 1}. ${q.q}</div>
          <div class="qChoices">${choicesHTML}</div>
          <div class="qActions"><button class="btnSecondary" onclick="editQuestion('${q.id}')">Edit</button></div>
        `;
        list.appendChild(card);
      });
    }

    function showAddForm() {
      editingId = null;
      document.getElementById('editQuestionText').value = '';
      document.getElementById('choiceEditor').innerHTML = '';
      for (let i = 0; i < 3; i++) addChoiceRow('', i === 0);
      document.getElementById('deleteBtn').style.display = 'none';
      document.getElementById('editorForm').classList.add('active');
    }

    function editQuestion(id) {
      const q = questions.find(x => x.id === id);
      if (!q) return;
      editingId = id;
      document.getElementById('editQuestionText').value = q.q;
      const editor = document.getElementById('choiceEditor');
      editor.innerHTML = '';
      q.c.forEach((choice, i) => addChoiceRow(choice, i === q.a));
      document.getElementById('deleteBtn').style.display = 'block';
      document.getElementById('editorForm').classList.add('active');
    }

    function addChoiceRow(text = '', isCorrect = false) {
      const editor = document.getElementById('choiceEditor');
      const row = document.createElement('div');
      row.className = 'choiceRow';
      row.innerHTML = `
        <input type="text" value="${text}" placeholder="Choice text...">
        <input type="radio" name="correctChoice" ${isCorrect ? 'checked' : ''}>
        <button onclick="this.parentElement.remove()">‚úï</button>
      `;
      editor.appendChild(row);
    }

    async function saveQuestion() {
      const qText = document.getElementById('editQuestionText').value.trim();
      if (!qText) { alert('Question text is required'); return; }
      const rows = document.getElementById('choiceEditor').querySelectorAll('.choiceRow');
      const choices = []; let correctIdx = -1;
      rows.forEach((row) => {
        const input = row.querySelector('input[type="text"]');
        const radio = row.querySelector('input[type="radio"]');
        const text = input.value.trim();
        if (text) { choices.push(text); if (radio.checked) correctIdx = choices.length - 1; }
      });
      if (choices.length < 2) { alert('Need at least 2 choices'); return; }
      if (correctIdx === -1) { alert('Please mark one answer as correct'); return; }
      if (editingId) {
        const q = questions.find(x => x.id === editingId);
        q.q = qText; q.c = choices; q.a = correctIdx;
      } else {
        questions.push({ id: 'q' + Date.now(), q: qText, c: choices, a: correctIdx });
      }
      await sbSaveQuestions(questions);
      localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(questions));
      cancelEdit(); refreshQuestionsList();
    }

    function cancelEdit() { document.getElementById('editorForm').classList.remove('active'); editingId = null; }

    function deleteCurrentQuestion() {
      if (!editingId) return;
      if (!confirm('Delete this question?')) return;
      questions = questions.filter(q => q.id !== editingId);
      localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(questions));
      sbSaveQuestions(questions).catch(() => {});
      cancelEdit(); refreshQuestionsList();
    }

    async function resetToDefaults() {
      if (!confirm('Reset to default questions?')) return;
      questions = [...DEFAULT_BANK];
      localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(questions));
      try { await sbSaveQuestions(questions); } catch(err) {}
      location.reload();
    }

    function exportQuestions() {
      const json = JSON.stringify(questions, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'quiz-questions.json'; a.click();
    }

    function importQuestions() {
      const input = document.createElement('input'); input.type = 'file'; input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            if (!Array.isArray(imported)) { alert('Invalid format'); return; }
            questions = imported;
            localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(questions));
            sbSaveQuestions(questions).catch(() => {});
            refreshQuestionsList(); alert('Import successful!');
          } catch(err) { alert('Error parsing JSON'); }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // === EGG SHATTER (Canvas + CSS) ===
    function shatterEgg(eggEl) {
      if (!eggEl) return;
      // Also crack the corresponding mobile egg
      const id = eggEl.id;
      const mobileEgg = document.getElementById('eggM' + id.replace('egg', ''));
      
      [eggEl, mobileEgg].forEach(el => {
        if (!el) return;
        // Phase 1: shake
        el.classList.add('shattering');
        setTimeout(() => {
          el.classList.remove('shattering');
          el.classList.add('cracked');
          
          // Create canvas for crack line + shell fragments
          const w = el.offsetWidth + 20;
          const h = el.offsetHeight + 20;
          const cvs = document.createElement('canvas');
          cvs.className = 'eggCanvas';
          cvs.width = w; cvs.height = h;
          cvs.style.width = w + 'px';
          cvs.style.height = h + 'px';
          el.appendChild(cvs);
          
          const ctx = cvs.getContext('2d');
          
          // Animate crack line drawing
          drawCrackLine(ctx, w, h);
          
          // Shell fragments
          spawnShellFragments(el);
          
          // Yolk + whites (CSS elements)
          const yolk = document.createElement('div');
          yolk.className = 'eggYolk';
          el.appendChild(yolk);
          
          const white = document.createElement('div');
          white.className = 'eggWhite';
          el.appendChild(white);
          
          // Shell halves
          const topHalf = document.createElement('div');
          topHalf.className = 'eggHalf top';
          el.appendChild(topHalf);
          
          const bottomHalf = document.createElement('div');
          bottomHalf.className = 'eggHalf bottom';
          el.appendChild(bottomHalf);
          
          // Drips
          const dripL = document.createElement('div');
          dripL.className = 'eggDrip left';
          el.appendChild(dripL);
          const dripR = document.createElement('div');
          dripR.className = 'eggDrip right';
          el.appendChild(dripR);
        }, 500);
      });
    }

    function drawCrackLine(ctx, w, h) {
      const cx = w / 2;
      let y = h * 0.15;
      const targetY = h * 0.85;
      const points = [{x: cx, y: y}];
      
      // Generate zigzag path
      while (y < targetY) {
        y += 3 + Math.random() * 6;
        const x = cx + (Math.random() - 0.5) * 14;
        points.push({x, y});
      }
      
      // Animate drawing
      let i = 0;
      function step() {
        if (i >= points.length - 1) return;
        ctx.strokeStyle = 'rgba(200,190,170,0.7)';
        ctx.lineWidth = 1.5;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(points[i].x, points[i].y);
        ctx.lineTo(points[i+1].x, points[i+1].y);
        ctx.stroke();
        
        // Branch lines
        if (Math.random() > 0.6) {
          ctx.strokeStyle = 'rgba(200,190,170,0.4)';
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(points[i+1].x, points[i+1].y);
          const bx = points[i+1].x + (Math.random() - 0.5) * 16;
          const by = points[i+1].y + (Math.random() - 0.5) * 8;
          ctx.lineTo(bx, by);
          ctx.stroke();
        }
        
        i++;
        if (i < points.length - 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function spawnShellFragments(eggEl) {
      const rect = eggEl.getBoundingClientRect();
      const colors = ['rgba(240,230,210,0.6)', 'rgba(220,210,190,0.5)', 'rgba(200,190,170,0.4)'];
      
      for (let i = 0; i < 6; i++) {
        const frag = document.createElement('div');
        frag.style.cssText = `
          position: absolute; width: ${3 + Math.random() * 5}px; height: ${3 + Math.random() * 5}px;
          background: ${colors[i % colors.length]}; border-radius: 30%;
          top: ${35 + Math.random() * 30}%; left: ${30 + Math.random() * 40}%;
          z-index: 15; pointer-events: none;
        `;
        const angle = (Math.random() - 0.5) * 3;
        const dist = 20 + Math.random() * 40;
        const dx = Math.cos(angle) * dist;
        const dy = -Math.abs(Math.sin(angle) * dist) - 10;
        
        frag.animate([
          { transform: 'translate(0,0) rotate(0deg) scale(1)', opacity: 1 },
          { transform: `translate(${dx}px, ${dy}px) rotate(${Math.random()*360}deg) scale(0.3)`, opacity: 0 }
        ], { duration: 600 + Math.random() * 400, easing: 'ease-out', fill: 'forwards' });
        
        eggEl.appendChild(frag);
        setTimeout(() => frag.remove(), 1100);
      }
    }

    // === SCORE ROLL-UP ===
    function animateScore(from, to, duration = 550) {
      const el = document.getElementById('scoreDisplay');
      if (!el) return;
      const start = performance.now();
      function tick(now) {
        const progress = Math.min((now - start) / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        el.innerText = Math.round(from + (to - from) * eased) + ' pts';
        if (progress < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function animateScoreEl(el, from, to, duration = 1200) {
      if (!el) return;
      const start = performance.now();
      function tick(now) {
        const progress = Math.min((now - start) / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        el.innerText = Math.round(from + (to - from) * eased) + ' pts';
        if (progress < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    // === FULL CONFETTI (victory) ===
    function launchConfetti() {
      const colors = ['#f5d76e','#ef4444','#22c55e','#3b82f6','#a855f7','#f97316','#14b8a6','#ec4899'];
      for (let i = 0; i < 80; i++) {
        setTimeout(() => {
          const piece = document.createElement('div');
          piece.className = 'confettiPiece';
          piece.style.left = (Math.random() * 100) + 'vw';
          piece.style.background = colors[Math.floor(Math.random() * colors.length)];
          piece.style.width  = (6 + Math.random() * 8) + 'px';
          piece.style.height = (8 + Math.random() * 10) + 'px';
          piece.style.animationDuration = (2.5 + Math.random() * 2.5) + 's';
          document.body.appendChild(piece);
          setTimeout(() => piece.remove(), 6000);
        }, Math.random() * 1500);
      }
    }

    function typewriterText(el, text, speed = 40) {
      el.innerText = '';
      let i = 0;
      function next() {
        if (i < text.length) { el.innerText += text[i]; i++; setTimeout(next, speed); }
      }
      next();
    }

    function showVictory(rank) {
      const popup = document.getElementById('victoryPopup');
      const finalScoreEl = document.getElementById('finalScore');
      const msgEl = document.getElementById('victoryMessage');
      const rankEl = document.getElementById('victoryRank');
      const statsEl = document.getElementById('victoryStats');

      const percent = (score / questions.length) * 100;
      let message = '';
      if (score === questions.length) message = 'Perfect score! You are a breakfast LEGEND! üèÜ';
      else if (percent >= 80) message = 'Excellent work! Almost there!';
      else if (percent >= 60) message = 'Good job! Keep studying!';
      else message = 'Nice try! Review the material and try again!';

      finalScoreEl.innerText = '0 pts';
      msgEl.innerText = '';
      rankEl.innerText = rank;
      statsEl.innerHTML = buildStatsHTML();

      injectEndScreenChicken('victoryChickenWrap', 'happy');

      popup.classList.remove('celebrating');
      void popup.offsetWidth;
      popup.style.display = 'block';
      popup.classList.add('celebrating');

      playSound('victory');
      setTimeout(() => launchConfetti(), 350);
      setTimeout(() => animateScoreEl(finalScoreEl, 0, totalPoints), 500);
      setTimeout(() => typewriterText(msgEl, message), 1400);
    }
  </script>

</body>
</html>
